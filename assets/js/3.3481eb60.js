(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{483:function(e,t,r){e.exports=r.p+"assets/img/sample_vba_a.0fe98adb.png"},484:function(e,t,r){e.exports=r.p+"assets/img/sample_vba_b.d7aaebc3.png"},485:function(e,t,r){e.exports=r.p+"assets/img/office2007_template_inject.d12403d6.png"},486:function(e,t,r){e.exports=r.p+"assets/img/cfb_sectors.376a1dbc.png"},487:function(e,t,r){e.exports=r.p+"assets/img/cfb_summary.74375884.png"},488:function(e,t,r){e.exports=r.p+"assets/img/ole_embedded_object.5730fecc.jpg"},489:function(e,t,r){e.exports=r.p+"assets/img/ole_linked_object.8828ce15.jpg"},490:function(e,t,r){e.exports=r.p+"assets/img/vba_storage_hierarchy.901caaf9.png"},491:function(e,t,r){e.exports=r.p+"assets/img/sample_vba_project.c635a9d2.png"},492:function(e,t){e.exports="data:image/png;base64,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"},522:function(e,t,r){"use strict";r.r(t);var s=r(14),a=Object(s.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"office-格式简析"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#office-格式简析"}},[e._v("#")]),e._v(" Office 格式简析")]),e._v(" "),s("p",[e._v("目前常见的 Microsoft Office 格式主要分为 97 ~ 2003 和 2007 ~ 两种格式。"),s("code",[e._v("Microsoft Office 97 ~ 2003")]),e._v(" 的文件格式都是由 MS-CFB 结构来表示的 OLE 文件。"),s("code",[e._v("Microsoft Office 2007 ~")]),e._v("则是由 OOXML 格式的文件结构压缩而成的 zip 包来存储。")]),e._v(" "),s("p",[e._v("而 OOXML 又是以 XML 文件为基础的，所以，概括的说，Office文档主要基于 ole、xml、ooxml 这三种文件格式构建起来的。")]),e._v(" "),s("p",[e._v("常见的文件扩展名以及用途如下：")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[e._v("Extensions")]),e._v(" "),s("th",[e._v("Usage")]),e._v(" "),s("th",[e._v("Remark")])])]),e._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[e._v("doc、xls、ppt")]),e._v(" "),s("td",[e._v("属于 97-2003 版 Office")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[e._v("docx、xlsx、pptx")]),e._v(" "),s("td",[e._v("属于 2007 ~ 版 Office 文档，但没有启用宏")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[e._v("docm、xlsm、pptm")]),e._v(" "),s("td",[e._v("属于启用了宏的 2007 ~ 版 Office 文档，可以存储 Visual Basic Applications（VBA）宏代码")]),e._v(" "),s("td")]),e._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[e._v("ppsx")]),e._v(" "),s("td",[e._v("是 2007 的 PPT 的一种格式，打开就是幻灯片播放模式")]),e._v(" "),s("td")])])]),e._v(" "),s("p",[e._v("按照我们常规的认知，一个文档应当包含以下几个部分：")]),e._v(" "),s("ol",[s("li",[e._v("文档内容\n"),s("ul",[s("li",[e._v("可能涉及对 embedded objects 或 external objects 的引用")]),e._v(" "),s("li",[e._v("文档的展示相关：字体、页面大小、打印方式等等")])])]),e._v(" "),s("li",[e._v("文档工具\n"),s("ul",[s("li",[e._v("为了更好、更方便的操作文档内容进行编辑、展示、提示以及其他功能，而提供的一些跟文档相关的组件，如 vba、formula、animation 等等")])])]),e._v(" "),s("li",[e._v("文档属性\n"),s("ul",[s("li",[e._v("如，创作时间、作者、最后修改时间等等")])])]),e._v(" "),s("li",[e._v("保护措施\n"),s("ul",[s("li",[e._v("签名")]),e._v(" "),s("li",[e._v("读(打开)、写 保护")])])])]),e._v(" "),s("h2",{attrs:{id:"一、malware"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、malware"}},[e._v("#")]),e._v(" 一、Malware")]),e._v(" "),s("p",[e._v("由于 ms-office 文件的广泛使用，恶意软件作者对其进行了充分的挖掘、利用，催生出了一系列针对这些文档的病毒，期中常常被用于恶意目的的组件或者方式有：宏病毒、漏洞利用、嵌入文件")]),e._v(" "),s("h3",{attrs:{id:"_1-1-漏洞"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-漏洞"}},[e._v("#")]),e._v(" 1.1 漏洞")]),e._v(" "),s("p",[e._v("漏洞利用是指软件自身缺陷被攻击者利用来执行高危动作，如利用 ole 的特点调用第三方组件并执行；栈溢出造成的任意代码执行漏洞(CVE-2017-11882) 等等，常见的漏洞有：")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:""}},[e._v("CVE-2017-11882")])]),e._v(" "),s("li",[s("a",{attrs:{href:"https://www.secpulse.com/archives/67027.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("CVE-2018-0802"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2019-0801",target:"_blank",rel:"noopener noreferrer"}},[e._v("CVE-2019-0801"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://bbs.pediy.com/thread-269266.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("CVE-2021-40444"),s("OutboundLink")],1)])]),e._v(" "),s("h3",{attrs:{id:"_1-2-宏病毒"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-宏病毒"}},[e._v("#")]),e._v(" 1.2 宏病毒")]),e._v(" "),s("p",[e._v("宏（Macro）是 ms-office 提供的一种利用一系列独立的 office 命令来实现任务执行的自动化，以简化日常工作的工具。当前的 ms-office 是使用 Visual Basic for Applications（VBA）编写的，它是 Microsoft 的 Visual Basic 编程语言专门为 Office 服务的一种变体。VBA 可在大多数 Office 程序中使用，例如 Access，Excel，Outlook，PowerPoint，Project，Publisher，Visio 和 Word 等等。")]),e._v(" "),s("p",[e._v("宏病毒主要是利用 宏 来进行感染和传播。它利用宏语言的功能寄存在文档或模板中，一旦带有宏病毒的文档被打开，宏就可能会执行，而宏病毒就会被激活。")]),e._v(" "),s("p",[e._v("它的主要感染路径大致如下："),s("code",[e._v("单个Office文档 => Office文档模板 => 多个Office文档")]),e._v("。")]),e._v(" "),s("p",[e._v("常见的宏主要存在于以下两种形式(vba && xlm)：\n"),s("center",{staticClass:"half"},[s("img",{attrs:{src:r(483),width:"300"}}),e._v(" "),s("img",{attrs:{src:r(484),width:"460"}})])],1),e._v(" "),s("p",[e._v("此外，还有一种攻击方式被称为「模板注入」，实际上还是上述两种 macros 的利用，不过内容可能会随时发生变化")]),e._v(" "),s("ul",[s("li",[s("img",{attrs:{src:r(485),alt:"office2007_template_inject"}})])]),e._v(" "),s("p",[e._v("此外，宏病毒常常用以下方式保护、隐藏自己：")]),e._v(" "),s("ol",[s("li",[e._v("禁止提示信息")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("On Error Resume Next                     '如果发生错误，不弹出出错窗口，继续执行下面语句\nApplication.DisplayAlerts = wdAlertsNone '不弹出警告窗口\nApplication.DisplayStatusBar = False     '不显示状态栏，以免显示宏的运行状态\nOptions.VirusProtection = False          '关闭病毒保护功能，运行前如果包含宏，不提示\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])]),s("ol",{attrs:{start:"2"}},[s("li",[e._v("屏蔽命令菜单，不许查看宏")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("' Disable或者删除特定菜单项，用来使“工具—宏”菜单失效的语句：\nCommandBars(“Tools”).Controls(16).Enabled = False\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br")])]),s("ol",{attrs:{start:"3"}},[s("li",[e._v("隐藏宏的真实代码")])]),e._v(" "),s("ul",[s("li",[e._v("在“自动宏”中，不包括任何感染或破坏的代码，但包含了创建、执行和删除新宏（实际进行感染和破坏的宏）的代码；将宏代码字体颜色设置成与背景一样的白色等")]),e._v(" "),s("li",[e._v("“自动宏” 是指利用 AutoExec、AutoNew、AutoOpen、AutoClose、AutoExit 自动触发执行的宏")])]),e._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[e._v("文档密码保护")])]),e._v(" "),s("ul",[s("li",[e._v("打开文档时需要密码 或者 查看vba脚本时需要密码")])]),e._v(" "),s("p",[e._v("另外，病毒作者常用"),s("strong",[e._v("密码逃逸")]),e._v("手段以增加检测难度，事实上也很有效。这种方法的全称是："),s("code",[e._v("VelvetSweatshop Default Password Ploy")]),e._v("。")]),e._v(" "),s("ul",[s("li",[e._v("对象：Excel 4.0 xls 97 ~ files with a compromised macro")]),e._v(" "),s("li",[e._v("表现：XLS files appear password protected but aren’t, opening automatically to install malware from compromised macros.")]),e._v(" "),s("li",[e._v("原因：Excel 会首先尝试使用默认密码 'VelvetSweatshop' 以 read-only 模式打开文件，如果失败时，再向用户要求输入密码。(This read-only technique has been known about for over 10 years.)")]),e._v(" "),s("li",[e._v("Reference\n"),s("ul",[s("li",[e._v("https://threatpost.com/hackers-update-age-old-excel-4-0-macro-attack/154898/")])])])]),e._v(" "),s("h3",{attrs:{id:"_1-3-embedded"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-embedded"}},[e._v("#")]),e._v(" 1.3 Embedded")]),e._v(" "),s("p",[e._v("利用复合文档可以内嵌其它文档的特性，可以嵌套如：")]),e._v(" "),s("ul",[s("li",[e._v("images、video、audio")]),e._v(" "),s("li",[e._v("other streams, eg. rtf、pdf、docx ... (rtf、docx等复合文档又可以继续嵌套... MY GOD ~)")])]),e._v(" "),s("h2",{attrs:{id:"二、ms-cfb"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、ms-cfb"}},[e._v("#")]),e._v(" 二、MS-CFB")]),e._v(" "),s("p",[e._v("经常被称为 OLE(Object Linking and Embedded)，实际上 OLE (是一种面向对象的技术)包含的内容更多，是 COM 技术的基础，而 CFB 只是 OLE 中关于文件格式的一种描述。")]),e._v(" "),s("p",[e._v("复合文档的物理结构比较简单：")]),e._v(" "),s("ul",[s("li",[s("img",{attrs:{src:r(486),alt:"cfb_sectors"}})])]),e._v(" "),s("p",[s("em",[e._v("注意：Compound File Header (512 bytes)也会独占一个 sector, 没有用到的地方填充 0.")])]),e._v(" "),s("p",[e._v("这里是逻辑结构：")]),e._v(" "),s("ul",[s("li",[s("img",{attrs:{src:r(487),alt:"cfb_summary"}})])]),e._v(" "),s("p",[e._v("文档中的内容都以 stream 来保持具体内容，storage 来组织 stream 的结构。而这些内容在文件中的位置、查找方式、解读方式，就由 "),s("code",[e._v("Directory Entry Array")]),e._v(" 来表达。")]),e._v(" "),s("p",[e._v("复合文档的结构非常类似 FAT 文件系统，storage 相当于 directory，stream 相当于 file。为了文件的快速定位，我们需要相应的分区索引表(DiFat 和 Fat)。在 复合文档中，为了节省空间，会将 sector 划分成等长的 "),s("code",[e._v("short-sector")]),e._v(" 用于小对象("),s("code",[e._v("short-stream")]),e._v(")的存储，而它的索引需要 "),s("code",[e._v("Mini-Fat")]),e._v("。")]),e._v(" "),s("p",[e._v("由于 CFB 文件由 sectors 组成，这里统一称呼为：")]),e._v(" "),s("ul",[s("li",[e._v("msat (master sector allocation table)，又名 DiFat")]),e._v(" "),s("li",[e._v("sat (sector allocation table)，又名 Fat")]),e._v(" "),s("li",[e._v("ssat (short-sector allocation table)")]),e._v(" "),s("li",[e._v("stream")]),e._v(" "),s("li",[e._v("short_stream")])]),e._v(" "),s("p",[e._v("他们的功能如下：")]),e._v(" "),s("ul",[s("li",[e._v("msat 表包含了用于构造 sat 表的 sectors 的 sid")]),e._v(" "),s("li",[e._v("sat 表包含了很多 sid 链(有特定的 sid 标识链条结束)\n"),s("ul",[s("li",[e._v("每个 sid 链上的 sectors 联合构成了一个完整的 object (如，stream、storage、directory entry array、ssat ...)的物理存储。")])])]),e._v(" "),s("li",[e._v("ssat 表包含了很多 ssid 链(有特定的 ssid 标识链条结束)\n"),s("ul",[s("li",[e._v("每个 ssid 链上的 short-sectors 联合构成了一个完整的 short-stream")])])])]),e._v(" "),s("p",[e._v("到这里，我们大概可以想到为了解析 CFB 结构，需要知道以下几个内容：")]),e._v(" "),s("ol",[s("li",[e._v("Directory Entry 的结构 和 存放位置")]),e._v(" "),s("li",[e._v("msat 表在文件中的位置")]),e._v(" "),s("li",[e._v("stream 和 short-stream 的切割点：什么情况下用 stream 什么时候用 short-stream")]),e._v(" "),s("li",[e._v("short-sector 存储于哪些 sector 中")]),e._v(" "),s("li",[e._v("ssid 存储于哪些 sector 中")])]),e._v(" "),s("p",[e._v("这些内容就存放在 Compound File Header 和 Directory Entry Root 中。")]),e._v(" "),s("h2",{attrs:{id:"ole"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ole"}},[e._v("#")]),e._v(" OLE")]),e._v(" "),s("p",[e._v("OLE, Object Linking and Embedded。")]),e._v(" "),s("p",[e._v("微软在 1991 年制定的 OLE1.0 规范，主要解决多个应用程序之间的通信和消息传递问题，微软希望第三方开发商能够遵守这个规范，以使在当时的Windows平台上的应用程序能够相互协调工作，更大的提高工作效率。然而事与愿违，只有很少的软件开发商支持它。为此，微软于1993 年发布了新的规范 OLE2.0，它在原有的基础上完善并增强了以下各方面的性能：")]),e._v(" "),s("ol",[s("li",[e._v("OLE自动化：一个程序有计划地控制另一个程序的能力。")]),e._v(" "),s("li",[e._v("OLE控件：小型的组件程序，可嵌入到另外的程序，提供自己的专有功能。")]),e._v(" "),s("li",[e._v("OLE文档：完善了早期的混合文档功能，不仅支持简单链接和嵌入，还支持在位激活、拖放等功能。")])]),e._v(" "),s("p",[e._v("强大的功能使得很多的开发商开始支持新的 OLE 技术，因为微软在 OLE2.0 中建立了 COM（Component Object Model即组件对象模式）规范。")]),e._v(" "),s("p",[e._v("OLE 相关的基础概念有：")]),e._v(" "),s("ul",[s("li",[e._v("容器：\n"),s("ul",[s("li",[e._v("容器是一个客户程序，它具有申请并使用其它COM组件通过接口为其它程序实现的功能；")])])]),e._v(" "),s("li",[e._v("服务器：\n"),s("ul",[s("li",[e._v("服务器通过特定的接口将自己完成的一些功能，提供给使用自己的应用程序（例如画笔程序是一个文档服务器，它提供创建并编辑BMP 图像的功能）。当打开Word，选择【插入】菜单下的【对象...】项，您可以看到在您的系统中存在哪些文档服务器，此时的Word以文档容器的身份出现。")])])]),e._v(" "),s("li",[e._v("在位激活：\n"),s("ul",[s("li",[e._v("当您双击插入的对象后发现Word的菜单有些改变成文档服务器程序的菜单，可以在当前的环境下编辑对象，这称为在位激活。")])])])]),e._v(" "),s("p",[e._v("简单的说，OLE 是一种可以用来创建复杂文档的技术，这些复杂文档可以包含来自不同渠道（数据源）的信息，并保留其原始属性。例如，一个支持 OLE 的文档（例如word）能够支持嵌入的表格对象，并且嵌入的文档会保留所有原来的属性。如果用户打算编辑嵌入的数据，windows 操作系统会激活原来的应用程序（如excel）并载入这个嵌入的文档。")]),e._v(" "),s("h3",{attrs:{id:"ole-格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ole-格式"}},[e._v("#")]),e._v(" OLE 格式")]),e._v(" "),s("p",[e._v("OLE 文件的 Property Sets 通过以下两个 stream 存储:")]),e._v(" "),s("ul",[s("li",[s("code",[e._v('"\\005SummaryInformation"')])]),e._v(" "),s("li",[s("code",[e._v('"\\005DocumentSummaryInformation"')])])]),e._v(" "),s("p",[e._v("这两个 stream 都以 PropertySetStream 结构(见 "),s("a",{attrs:{href:""}},[e._v("MS-OSHARED")]),e._v(" 的 section3.2.1 )开头。")]),e._v(" "),s("p",[e._v("OLE文件中包含的常见内容主要有：")]),e._v(" "),s("h4",{attrs:{id:"_1-linked-or-embedded-object"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-linked-or-embedded-object"}},[e._v("#")]),e._v(" 1. linked or embedded object")]),e._v(" "),s("p",[e._v("包含嵌入、链接对象的容器文档的逻辑布局如下图：\n"),s("center",{staticClass:"half"},[s("img",{attrs:{src:r(488),width:"460"}}),e._v(" "),s("img",{attrs:{src:r(489),width:"300"}})])],1),e._v(" "),s("ul",[s("li",[e._v("OLEStream\n"),s("ul",[s("li",[e._v('OLE2.0 中，由复合文档的以 "\\1Ole" 为名的 stream object 包含。OLEStream structure 表述了存储对象是用于 linked object 还是 embedded object。当此结构是为 linked object 指定 storage object 时，它还指定了对此链接对象的引用。')])])]),e._v(" "),s("li",[e._v("CompObjStream\n"),s("ul",[s("li",[e._v('OLE2.0 中，名为 "\\1CompObj" 的流，主要用于描述 Clipboard Format、用于显示的linked object 或 embedded object 的名字。')])])]),e._v(" "),s("li",[e._v("Embedded Object Native Data\n"),s("ul",[s("li",[e._v("OLE1.0 中，其由 EmbeddedObject structure 的 NativeData field 指定。")]),e._v(" "),s("li",[e._v("OLE2.0 中，Native Data 的指定方式有以下两种，可以互换使用：\n"),s("ul",[s("li",[e._v('由复合文档的以 "\\1Ole10Native" 为名的 stream object 包含。如 OLENativeStream structure 的 NativeData field 所指定。')]),e._v(" "),s("li",[e._v("由 creating application 创建的 stream objects 可以包含 native data。此类流对象是 creating application 的私有对象，未在文档中说明。\n"),s("ul",[s("li",[e._v("creating application: An application whose data is stored in or referenced by documents from other applications.")])])])])])])]),e._v(" "),s("li",[e._v("Embedded Object Presentation Data\n"),s("ul",[s("li",[e._v("用于指定如何在 container application 中显示 linked or embedded object 对象")]),e._v(" "),s("li",[e._v("OLE1.0 中，其由 EmbeddedObject structure 的 Presentation field 指定")]),e._v(" "),s("li",[e._v('OLE2.0 中，由复合文档的以 "\\2OlePres" 为前缀(后跟着3个十进制数字，并且最多只能有999个Presentations)的 stream objects 指定。每一个 stream 都包含一个 OLEPresentationStream structure。')])])])]),e._v(" "),s("h4",{attrs:{id:"_2-宏"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-宏"}},[e._v("#")]),e._v(" 2. 宏")]),e._v(" "),s("p",[e._v("常见的 宏 有两种：vba 和 ms-excel4.0, 它们出现的主要位置有：")]),e._v(" "),s("ul",[s("li",[e._v("vba project\n"),s("ul",[s("li",[e._v("office97 ~ 2003: vba project storage")]),e._v(" "),s("li",[e._v("office2007 ~ : vbaProject.bin")])])]),e._v(" "),s("li",[e._v("microsoft office excel 4.0\n"),s("ul",[s("li",[e._v("office97 ~ 2003: book\\workbook stream\n"),s("ul",[s("li",[e._v("注：主要通过 BIFF 格式保存了 formula、drawing group 等内容")])])]),e._v(" "),s("li",[e._v("office2007 ~ : macrosheets\n"),s("ul",[s("li",[e._v("Microsoft 365 新增 "),s("a",{attrs:{href:"https://support.microsoft.com/en-us/office/lambda-function-bd212d27-1cd1-4321-a34a-ccbf254b8b67",target:"_blank",rel:"noopener noreferrer"}},[e._v("LAMBDA function"),s("OutboundLink")],1)])])])])]),e._v(" "),s("li",[e._v("macro template\n"),s("ul",[s("li",[e._v("office2007 ~ : /[xx]/_rels/settings.xml.rels 中引用外部(远程)模板文件")])])]),e._v(" "),s("li",[e._v("VbaProjectStg\n"),s("ul",[s("li",[e._v("binary powerpoint document 中用于指定一个用于 VBA project 的结构化存储")])])])]),e._v(" "),s("h4",{attrs:{id:"_3-officeart"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-officeart"}},[e._v("#")]),e._v(" 3. officeart")]),e._v(" "),s("ul",[s("li",[e._v("office97 ~ 2003:\n"),s("ul",[s("li",[e._v("worddocument、book\\workbook、'powerpoint document' stream\n"),s("ul",[s("li",[e._v("Office Drawing Binary File Format (MS-ODRAW)，This file format is also known as OfficeArt.")])])])])]),e._v(" "),s("li",[e._v("office2007 ~ :\n"),s("ul",[s("li",[s("em",[e._v("TODO")])])])])]),e._v(" "),s("h4",{attrs:{id:"_4-encryption-and-obfuscation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-encryption-and-obfuscation"}},[e._v("#")]),e._v(" 4. encryption and obfuscation")]),e._v(" "),s("p",[e._v("详见 "),s("RouterLink",{attrs:{to:"/blog/skills/office/ole_office_msoffcrypto.html"}},[e._v("Office 格式简析 - Crypto")])],1),e._v(" "),s("p",[e._v("这里需要注意的是 vba project 的保护(待确认)：")]),e._v(" "),s("ul",[s("li",[e._v("vba project\n"),s("ul",[s("li",[e._v("可以对其中的 stream 设置独立的密码 (未确认)\n"),s("ul",[s("li",[e._v("VBA uses a reversible encryption algorithm for selected data.")])])]),e._v(" "),s("li",[e._v("PROJECT Stream: ProjectProtectionState\n"),s("ul",[s("li",[e._v('ProjectProtectionState: "CMG="0705D8E3D8EDDBF1DBF1DBF1DBF1"" specifies no sources are restricted access to the VBA project. The value is obfuscated by Data Encryption (section 2.4.3).')]),e._v(" "),s("li",[e._v('ProjectPassword (section 2.3.1.16): "DPB="0E0CD1ECDFF4E7F5E7F5E7"" specifies the VBA project has no password. The value is obfuscated by Data Encryption (section 2.4.3).')]),e._v(" "),s("li",[e._v('ProjectVisibilityState (section 2.3.1.17): "GC="1517CAF1D6F9D7F9D706"" specifies the VBA project is visible. The value is obfuscated by Data Encryption (section 2.4.3).')]),e._v(" "),s("li",[e._v('LibName: "VBE" specifies a built in name for the VBA Automation type library.')])])])])])]),e._v(" "),s("h3",{attrs:{id:"vba-project-格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vba-project-格式"}},[e._v("#")]),e._v(" VBA Project 格式")]),e._v(" "),s("p",[e._v("VBA project 是由一系列 records 组成的结构。其中每个 record 都定义了 project 的三要素之一的部分内容。每个 record 都是以结构开头："),s("code",[e._v("ID(2 bytes) + Size(4 bytes) + ...")])]),e._v(" "),s("p",[e._v("project 的三要素有：project information, project references, and project items.")]),e._v(" "),s("h4",{attrs:{id:"_1-project-information"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-project-information"}},[e._v("#")]),e._v(" 1. project information")]),e._v(" "),s("p",[e._v("ole 中 VBA 存储(storage)结构如下：")]),e._v(" "),s("p",[s("img",{attrs:{src:r(490),alt:"VBA"}})]),e._v(" "),s("p",[e._v("其中 Project Root Storage 是一个独立的 storage。例如，OLE 文件中的 Macros storage。")]),e._v(" "),s("ul",[s("li",[e._v("VBA Storage\n"),s("ul",[s("li",[e._v("sub-structure\n"),s("ul",[s("li",[e._v("_VBA_PROJECT Stream\n"),s("ul",[s("li",[e._v("MUST")]),e._v(" "),s("li",[e._v("包含了 VBA project 的基础信息，如，版本号(用于加载此结构的剩余内容) 等")])])]),e._v(" "),s("li",[e._v("dir Stream\n"),s("ul",[s("li",[e._v("MUST")]),e._v(" "),s("li",[e._v("指明 VBA project properties, project references, 和 module properties")]),e._v(" "),s("li",[e._v("The entire stream MUST be compressed as specified in Compression")])])]),e._v(" "),s("li",[e._v('"Module Stream"\n'),s("ul",[s("li",[e._v("VBA project 中的每个 module 必须拥有一个 Module Stream")]),e._v(" "),s("li",[e._v("VBA project 中 modules 的源码。此 stream 的名字由 MODULESTREAMNAME 指定。")])])]),e._v(" "),s("li",[e._v("SRP Streams\n"),s("ul",[s("li",[e._v("Optional")]),e._v(" "),s("li",[e._v("指定 特定实现和版本相关 的性能缓存的流。必须是读取时忽略。写入时不得出现。")])])])])])])]),e._v(" "),s("li",[e._v("PROJECT Stream\n"),s("ul",[s("li",[e._v("MUST")]),e._v(" "),s("li",[e._v("VBA Project Properties, 如 工程的目录结构、脚本类型、module的可编辑窗口的信息等等, 以及一些 VBA project 的附加信息，如：ProjectPassword、ProjectVisibilityState 等 "),s("img",{attrs:{src:r(491),alt:"sample_vba_project"}}),e._v(" 注："),s("a",{attrs:{href:""}},[e._v("[MS-OVBA] - v20200219 的 2.3.1.3 ProjectModule")]),e._v(" 有脚本类型的相关说明")])])]),e._v(" "),s("li",[e._v("PROJECTwm Stream\n"),s("ul",[s("li",[e._v("Optional")]),e._v(" "),s("li",[e._v("包含了用于 module name 在 multibyte character set (MBCS) 和 UTF-16 之间互相映射的信息")])])]),e._v(" "),s("li",[e._v("PROJECTlk Stream\n"),s("ul",[s("li",[e._v("Optional")]),e._v(" "),s("li",[e._v("包含了 VBA project 中的 ActiveX controls 的 license 信息")])])]),e._v(" "),s("li",[e._v("Designer Storages\n"),s("ul",[s("li",[e._v("Optional")]),e._v(" "),s("li",[e._v("每个 vba project 中的 designer module 都必定有一个与之对应的 designer storage ，此 storage 的名字由 dir stream 中相关 module 中的 MODULESTREAMNAME record 指定。")]),e._v(" "),s("li",[e._v("每个 designer storage 必定有一个 VBFrame Stream\n"),s("ul",[s("li",[e._v('VBFrame Stream，用于描述 designer module 的属性信息，此 stream 的名字必须是以 UTF-16 character 0x0003 开头紧接着是  UTF-16 的 "VBFrame"。')])])]),e._v(" "),s("li",[e._v("如果此 designer 是一个 Office Form ActiveX control, 那么此 storage 必定包含 "),s("code",[e._v("[MS-OFORMS] section 2")]),e._v("中描述的必须 storages 和 streams。")])])])]),e._v(" "),s("h4",{attrs:{id:"_2-project-references"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-project-references"}},[e._v("#")]),e._v(" 2. project references")]),e._v(" "),s("p",[e._v("dir Stream 中的 records 包含了 VBA project 对外部资源引用的信息。主要有三类：REFERENCECONTROL、REFERENCEREGISTERED、REFERENCEPROJECT。")]),e._v(" "),s("h4",{attrs:{id:"_3-project-items"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-project-items"}},[e._v("#")]),e._v(" 3. project items")]),e._v(" "),s("p",[e._v("VBA project 包含一系列用于嵌入 macros 的 project items。而 project item 是由多个 records 组合定义。主要有以下 5 种 project item(详见 MS-OVBA 文档): "),s("code",[e._v("project package, document modules, procedural modules, class modules")]),e._v(" 和 "),s("code",[e._v("designer modules")]),e._v("。")]),e._v(" "),s("h3",{attrs:{id:"microsoft-office-excel-4-0"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#microsoft-office-excel-4-0"}},[e._v("#")]),e._v(" Microsoft Office Excel 4.0")]),e._v(" "),s("p",[e._v("Microsoft Office Excel 4.0, 主要存在于 MS-XLS 的 book\\workbook stream 中。此 stream 以 BIFF8(Binary Interchange File Format) 格式组织各个细节。")]),e._v(" "),s("p",[e._v("使用 Excel 4 Macros 的一些细节：")]),e._v(" "),s("ul",[s("li",[e._v("使用 relative named range 时，函数主体和结果之间的单元格距离必须都相同，否则可能会计算出错误的结果。")]),e._v(" "),s("li",[e._v("Office 2007 ~ 中，任何带有 Excel 4 Macro 的文件都必须另存为启用宏的工作簿 (.xlsm)，尝试另存为标准 Excel 文件将触发以下错误消息:\n"),s("img",{attrs:{src:r(492),alt:"must_save_excel4_as_xlsm"}})]),e._v(" "),s("li",[e._v("任何包含数组的函数，例如 GET.WORKSPACE(37) 或 NAMES() 都应该包含在 INDEX 函数中: 如，=INDEX(GET.WORKSPACE(37),!A1)，在这个例子中，A1 包含应该检索的数组中的数字，例如如果 A1 包含值 2，它将返回 GET.WORKSPACE(37) 数组中的第二项。")]),e._v(" "),s("li",[e._v("使用 Macro Worksheet 时，工作表设置为显示公式，而不是公式的结果。可以使用 "),s("code",[e._v("Ctrl + |")]),e._v(" 在公式视图和结果视图之间切换。")])]),e._v(" "),s("p",[e._v("解析过程中遇到的问题：")]),e._v(" "),s("ul",[s("li",[e._v("RgceLoc 可以按照 RgceLocRel 来解析，以简化解析流程。")]),e._v(" "),s("li",[e._v('解析 formula 的过程中，会遇到 "is part of a revision or not" 的分支流程，这里涉及以下三个概念：\n'),s("ul",[s("li",[e._v("UserBView Record:\n"),s("ul",[s("li",[e._v("fPersonalView : MUST be 0 if this is not a shared workbook.")])])]),e._v(" "),s("li",[e._v("Revision Stream\n"),s("ul",[s("li",[e._v("An instance of the Revision Stream specifies the revision logs (section 2.2.11.2) and revision records (section 2.2.11.3) for a shared workbook (section 2.2.11).")]),e._v(" "),s("li",[e._v('The name of this stream MUST be "Revision Log". A file MUST contain at most one Revision Stream. The Revision Stream MUST exist if the workbook is a shared workbook.')])])]),e._v(" "),s("li",[e._v("Revision Records\n"),s("ul",[s("li",[e._v("a series of records. 详情可以参考 [MS-XLS] 文档。")])])])])]),e._v(" "),s("li",[e._v("external references：\n"),s("ul",[s("li",[e._v("Supporting Link 包含了 Self-Referencing、Same-Sheet Referencing、External Workbook Referencing 等等类型。")])])]),e._v(" "),s("li",[e._v("name manager:\n"),s("ul",[s("li",[e._v("LblRecord : TODO (关联 name 和 sheet)\n"),s("ul",[s("li",[e._v("内置名字的索引，可能由 1 或 2 字节表示")]),e._v(" "),s("li",[e._v("NameParsedFormula 可能出现 ptgRef3d 的 ixti == 0xFFFF，此时，此时的结构未被文档记录：\n"),s("ul",[s("li",[e._v("we can reproduce it: make a macro sheet in ooxml and export it to xls.")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("  \t\tuint8_t ptg = uint8_t(data[cce_offset] & 0x7f);\n  \t\tif (ptg == ptgRef3d || ptg == ptgRef3dA || ptg == ptgRef3dV) {\n  \t\t\tuint16_t ixti = *(uint16_t*)(data + cce_offset + 1);\n  \t\t\tif (ixti > 0xFF00 && record->cce >= 15 + 3) {\n  \t\t\t\tassert(record->itab == 0 || record->itab == 1);\n      uint16_t iscope_1base = (record->itab == 1) ? record->reserved1 : record->itab;\n  \t\t\t\tuint16_t isheet_0base_a = *(uint16_t*)(data + cce_offset + 11);\n  \t\t\t\tuint16_t isheet_0base_b = *(uint16_t*)(data + cce_offset + 13);\n  \t\t\t\tassert(isheet_0base_a == isheet_0base_b);\n  \t\t\t\tauto row = *(uint16_t*)(data + cce_offset + 15);\n  \t\t\t\tauto col = (uint16_t)*(uint8_t*)(data + cce_offset + 17);\n  \t\t\t}\n  \t\t}\n  \t}\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br")])])])])])])]),e._v(" "),s("li",[e._v("Rgce 的 ACTUAL_PTG_SIZE 跟实际情况不符合")])]),e._v(" "),s("h3",{attrs:{id:"doc"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#doc"}},[e._v("#")]),e._v(" DOC")]),e._v(" "),s("p",[e._v("一个 doc 文档应当由以下几个部分组成：")]),e._v(" "),s("ol",[s("li",[e._v("WordDocument stream\n"),s("ul",[s("li",[e._v("有一个 FIB structure 在流的起始位置")])])]),e._v(" "),s("li",[e._v("Table stream\n"),s("ul",[s("li",[e._v("1Table 或者 0Table 流必定存在。当二者同时存在时，base.fWhichTblStm 指定的为有效流，忽略其他即可。")]),e._v(" "),s("li",[e._v("如果文档被加密的话，会有一个 EncryptionHeader 结构在流的起始位置。反之，如果文档没有加密，则此流没有预定义的结构。")]),e._v(" "),s("li",[e._v("存储了文档的文本信息")])])]),e._v(" "),s("li",[e._v("Data stream\n"),s("ul",[s("li",[e._v("没有预定义的结构，也不是必定存在。它包含的是 FIB 或 文件的其它部分的引用数据，也就是说如果没有引用数据的话，这个流没有存在的必要")])])]),e._v(" "),s("li",[e._v("ObjectPool storage\n"),s("ul",[s("li",[e._v("Object Pool storage 包含一些用于持久化 embedded OLE objects 的 storages。如果文档没有 embedded OLE objects 时，是不会出现此 storage 的。")]),e._v(" "),s("li",[e._v('每一个位于 ObjectPool storage 中的 storage 都有一个 ObjInfo Stream (名为 "\\003ObjInfo")，这个流里存放着用于描述 embedded OLE object 信息的 ODT structure。\n'),s("ul",[s("li",[e._v("embedded OLE object 相关的其他流的描述可以参考 "),s("a",{attrs:{href:""}},[e._v("Embedded Object Native Data")]),e._v(" 相关内容")])])]),e._v(" "),s("li",[e._v('每个 sub-storage 都存储了一个用户嵌入(embedded)的文件。并且，每个 sub-storage 都是以: 下划线"_" + 10个digits 组成，如 _1557814583\n'),s("ul",[s("li",[e._v("关联引用的关键词：sprmCFOle2、sprmCPicLocation")])])])])]),e._v(" "),s("li",[e._v("Summary Information\n"),s("ul",[s("li",[e._v("Summary Information stream")]),e._v(" "),s("li",[e._v("Document Summary Information stream")]),e._v(" "),s("li",[e._v("Encrypt stream\n"),s("ul",[s("li",[e._v("名为 encryption 的流，只有当以下两个条件同时满足才会出现：文档被 RC4 CryptoAPI 加密， 并且，EncryptionHeader.Flags 的 fDocProps 标记被置位")])])])])]),e._v(" "),s("li",[e._v("Macros stream\n"),s("ul",[s("li",[e._v("vba project")])])]),e._v(" "),s("li",[e._v("Signature\n"),s("ul",[s("li",[e._v("参考 "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/openspecs/office_file_formats/ms-offcrypto/2770c801-5f0f-4326-89e8-d6ef15b68ef1",target:"_blank",rel:"noopener noreferrer"}},[e._v("MS-OFFCRYPTO"),s("OutboundLink")],1),e._v(" 中的说明。")])])]),e._v(" "),s("li",[e._v("Protected Content")])]),e._v(" "),s("ul",[s("li",[e._v("由 IRMDS 描述的方式进行保护的内容, 在 "),s("a",{attrs:{href:"https://docs.microsoft.com/en-us/openspecs/office_file_formats/ms-offcrypto/278b0e42-9080-48fc-806f-7d4f6b264fb0",target:"_blank",rel:"noopener noreferrer"}},[e._v("MS-OFFCRYPTO"),s("OutboundLink")],1),e._v(" 有描述。")])]),e._v(" "),s("h3",{attrs:{id:"ppt"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ppt"}},[e._v("#")]),e._v(" PPT")]),e._v(" "),s("p",[e._v("按照 [MS-PPT] - v20210817 ：pageno 28 中 Part 1 ~ 11 的描述，即可解出完整的 ppt 文档内容。")]),e._v(" "),s("p",[e._v("注意：the UserEditAtom record closest to the end of the PointPower Document stream")]),e._v(" "),s("p",[e._v('其中，所有用于 presentation 的文本都存储在 "PowerPoint Document" stream 中；所有用于 presentation 的 images 都存储在Pictures stream 中；不过，Embedded files 没有存储在独立的 storages，而是被融合到 "PowerPoint Document" stream 中，此外，这些 embedded files 在存储时，有些会被压缩有些却不会。')]),e._v(" "),s("h4",{attrs:{id:"external-objects"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#external-objects"}},[e._v("#")]),e._v(" External Objects")]),e._v(" "),s("p",[e._v("Slides 可以包含连接到外部的 objects。播放 ppt 的人可以在幻灯片放映期间激活链接对象以访问外部资源。External Objects 的例子有 embedded and linked audio, linked video, embedded and linked OLE objects, 以及 hyperlinks。")]),e._v(" "),s("p",[e._v("也就是说 Embedded or Linked Object 在 ppt 中的存在形式就是 External Objects。")]),e._v(" "),s("p",[e._v("有关有 External Objects 的记录，请参阅 "),s("a",{attrs:{href:""}},[e._v("[MS-PPT] External Object Types (section 2.10)")]),e._v(" 相关内容。简单的说，为了解析出 External Objects，我们需要关注：")]),e._v(" "),s("ul",[s("li",[e._v("ExternalObjectStorage 0x1011 , 用于对象存储(如果有n个则会有n个此类型的 record)")]),e._v(" "),s("li",[e._v("DocumentContainer 0x03E8 , 用于描述文档对象\n"),s("ul",[s("li",[e._v("DocInfoListContainer 0x07D0\n+ VBAInfoContainer 0x03FF\n+ VBAInfoAtom  0x0400\n"),s("ul",[s("li",[e._v("ExObjListContainer 0x0409\n"),s("ul",[s("li",[e._v("storage for compressed/uncompressed OLE/VBA/ActiveX control data")])])]),e._v(" "),s("li",[e._v("SoundCollectionContainer")]),e._v(" "),s("li",[e._v("DrawingGroupContainer")])])])])])]),e._v(" "),s("p",[e._v("关于鉴别 embedded OLE object 对象的具体步骤可以参考 "),s("a",{attrs:{href:""}},[e._v("[MS-PPT] 2.1.2 PowerPoint Document Stream  part 9")]),e._v(" 相关内容")]),e._v(" "),s("p",[e._v("关于鉴别 linked OLE object 对象的具体步骤可以参考 "),s("a",{attrs:{href:""}},[e._v("[MS-PPT] 2.1.2 PowerPoint Document Stream  part 10")]),e._v(" 相关内容")]),e._v(" "),s("h3",{attrs:{id:"xls"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#xls"}},[e._v("#")]),e._v(" XLS")]),e._v(" "),s("p",[e._v("一个 xls 文件最多只能一个 Component Object Stream。\n一个 xls 文件最多只能一个 OLE Stream。\n一个 xls 文件最多只能一个 Control Stream。")]),e._v(" "),s("p",[e._v("WorkBook stream 中存储了 excel 中所有的 text 和 formulas。")]),e._v(" "),s("h4",{attrs:{id:"embedded-or-linked-object"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#embedded-or-linked-object"}},[e._v("#")]),e._v(" Embedded or Linked Object")]),e._v(" "),s("p",[e._v('在 Excel 的 workbook 中嵌入一个文件的话，这些文件会被存储在名为 "MBD + 随机的8个十六进制数字" 的 Embedding Storages 中。')]),e._v(" "),s("p",[e._v("每个 Embedding Storage 都表示了一个基于 storage-based 持久化的 embedded OLE object 或 ActiveX control 对象。同时，持久化在 Embedding Storage 的对象必定有一个相关联的 Obj record 在 worksheet substream、macro sheet substream 或 dialog sheet substream 中，并且 cmo.ot == 8，pictFlags.fPrstm == pictFlags.fDde == 0。")]),e._v(" "),s("p",[e._v("不过不同类型的文件在 Embedding Storage 中的形式有些不一样，如：")]),e._v(" "),s("ol",[s("li",[e._v("如果 embedded file 是另外一个 binary Office document, 那么这个 embedded file 中的 storages 和 streams 会被当成对应的节点原样存储在 MDB storage 中")]),e._v(" "),s("li",[e._v('如果 embedded file 是一个 Open XML document, 那么这个 embedded file 会被完整存储在名为 "Package" 的 stream 中')])]),e._v(" "),s("p",[e._v('一个 Link Storage 指定一个 linked OLE object 和任意其他的默认数据或表示为其建立的缓存。它的名字必定是由："LNK" + 8个十六进制数字 标识。持久化在 Link Storage 的对象必定有一个相关联的 Obj record (Obj.pictFmla.lPosInCtlStm)在 worksheet substream、macro sheet substream 或 dialog sheet substream 中，并且 cmo.ot == 8，pictFlags.fPrstm == pictFlags.fDde == 0。')]),e._v(" "),s("h2",{attrs:{id:"ooxml"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ooxml"}},[e._v("#")]),e._v(" OOXML")]),e._v(" "),s("p",[e._v("OOXML(Office Open XML File Formats), 简单来说，OOXML 是一个基于 XML 的文档格式标准，最早是微软 Office2007 的产品开发技术规范，先是成为 Ecma(ECMA-376) 的标准，最后改进推广成为了 ISO 和 IEC (as ISO/IEC 29500) 的国际文档格式标准。也就是说，通过 OOXML 标准，我们能够在不依赖 Office 产品的情况下，在任何平台读写Office Word，PPT 和 Excel 文件。")]),e._v(" "),s("p",[e._v("OOXML 的主要目录结构如下所示：")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("OOXML\n├── [Content_Types].xml // 描述文档各个部分的ContentType，协助解析文档\n│           \n├─ docProps\n│   ├── app.xml    //程序级别的文档属性，如：页数、文本行数、程序版本等\n│   └── core.xml   //用户填写的文档属性，如：标题、主题、作者等\n│\n├─ _rels\n│   └── .rels      //描述各个部分之间的关系\n│\n└─ word / xl / ppt\n    ├── document.xml     //word\n    ├── fontTable.xml    //word，页脚\n    │\n    ├── workbook.xml     // xl\n    ├── worksheets       // xl\n    │    └── sheet1.xml\n    ├── macrosheets      // xl, microsoft excel 4.0 macros\n    │      ├── _rels\n    │      │   └── sheet1.xml.rels\n    │      └── sheet1.xml\n    |\n    |── presentation.xml // ppt\n    |\n    |── embeddings       //all, optional, 存放 embedded files\n    |     ├── a\n    |     └── b\n    │\n    |── vbaData.xml      //all, vba属性，是否auoopen，是否加密\n    |── vbaProject.bin   //all, 记录 vba project 信息, ole 格式\n    |\n    ├─ theme             //all, 记录样式，颜色编号，字体大小等等\n    │    └── theme1.xml\n    │\n    ├─ _rels             //all, relationships\n    |    ├── settings.xml.rels   // 指定 模板 引用\n    │    ├── document.xml.rels   // 使用 ID 和 URL 来定义文档各零件\n    │    └── vbaProject.bin.rels // vba\n    │ \n    ├── printerSettings //all, Reference to Printer Settings Data\n    │      └── printerSettings1.bin\n    │ \n    └─ styles.xml       //all\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br"),s("span",{staticClass:"line-number"},[e._v("26")]),s("br"),s("span",{staticClass:"line-number"},[e._v("27")]),s("br"),s("span",{staticClass:"line-number"},[e._v("28")]),s("br"),s("span",{staticClass:"line-number"},[e._v("29")]),s("br"),s("span",{staticClass:"line-number"},[e._v("30")]),s("br"),s("span",{staticClass:"line-number"},[e._v("31")]),s("br"),s("span",{staticClass:"line-number"},[e._v("32")]),s("br"),s("span",{staticClass:"line-number"},[e._v("33")]),s("br"),s("span",{staticClass:"line-number"},[e._v("34")]),s("br"),s("span",{staticClass:"line-number"},[e._v("35")]),s("br"),s("span",{staticClass:"line-number"},[e._v("36")]),s("br"),s("span",{staticClass:"line-number"},[e._v("37")]),s("br"),s("span",{staticClass:"line-number"},[e._v("38")]),s("br"),s("span",{staticClass:"line-number"},[e._v("39")]),s("br"),s("span",{staticClass:"line-number"},[e._v("40")]),s("br"),s("span",{staticClass:"line-number"},[e._v("41")]),s("br"),s("span",{staticClass:"line-number"},[e._v("42")]),s("br"),s("span",{staticClass:"line-number"},[e._v("43")]),s("br")])]),s("h2",{attrs:{id:"rtf"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rtf"}},[e._v("#")]),e._v(" RTF")]),e._v(" "),s("p",[e._v("富文本格式（Rtf，rich text tormat）是微软的文本和图像信息交换指定的格式。Rtf文件可以划分为文件头和文档区两个部分组成。文件头和文档区由文本、控制字和控制符组成，同时利用{…}来表明层级关系。")]),e._v(" "),s("blockquote",[s("p",[e._v("TODO:")])]),e._v(" "),s("h3",{attrs:{id:"检出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#检出"}},[e._v("#")]),e._v(" 检出")]),e._v(" "),s("ul",[s("li",[e._v("hash (忽略大小写、空字符)\n"),s("ul",[s("li",[e._v("function")]),e._v(" "),s("li",[e._v("stream")])])]),e._v(" "),s("li",[e._v("模糊匹配\n"),s("ul",[s("li",[e._v("简单的模式匹配")]),e._v(" "),s("li",[e._v("eg.\n"),s("ul",[s("li",[e._v("搜索到 ：VirtualProtectEx、WriteProcessMemory、CreateRemoteThread、VirtualAllocEx")]),e._v(" "),s("li",[e._v('Shell Environ$("comspec") & " /c attrib -S -h """ & Application.StartupPath & "\\K4.XLS""", vbMinimizedFocus')]),e._v(" "),s("li",[e._v('Shell ("\\jdq\\cc$\\b.exe")')]),e._v(" "),s("li",[e._v('If .Lines(1, 1) = "APMP" & .Lines(1, 2) <> "KILL" Then ........ End If')]),e._v(" "),s("li",[e._v("混淆的文件：熵 ？")])])])])])]),e._v(" "),s("h3",{attrs:{id:"清理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#清理"}},[e._v("#")]),e._v(" 清理")]),e._v(" "),s("ul",[s("li",[e._v("抹除\n"),s("ul",[s("li",[e._v("function\n"),s("ul",[s("li",[e._v("替换函数内容为空格")])])]),e._v(" "),s("li",[e._v("stream :\n"),s("ul",[s("li",[e._v("将 stream 的 size 置 0，同时抹除第一个扇区内容，断开内容扇区链")]),e._v(" "),s("li",[e._v("一般来说，只修改 size 就可以让 office 软件无法读取相关内容。但其他杀软可能会继续报毒，毕竟 stream 的其他信息依然有效，可以在容错情况下还原出来 malicious 内容。")]),e._v(" "),s("li",[e._v("注意：其它部分对 macro 的引用，如 doc 中 fcCmds 会通过 macro names 引用对应的宏")])])])])]),e._v(" "),s("li",[e._v("还原\n"),s("ul",[s("li",[e._v("还原被加密破坏的文件内容\n"),s("ul",[s("li",[e._v("病毒感染时是有机会操作原有的正常 vba 脚本的，比如，加密（目前还没见到此类样本）。")])])])])])]),e._v(" "),s("h2",{attrs:{id:"reference"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reference"}},[e._v("#")]),e._v(" Reference")]),e._v(" "),s("ul",[s("li",[s("p",[s("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/deployoffice/compat/office-file-format-reference",target:"_blank",rel:"noopener noreferrer"}},[e._v("MS-Office-Extensions"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.microsoft.com/en-us/openspecs/office_file_formats/ms-offfflp/8aea05e3-8c1e-4a9a-9614-31f71e679456",target:"_blank",rel:"noopener noreferrer"}},[e._v("MS-Office File Formats"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.microsoft.com/en-us/openspecs/office_file_formats/ms-ovba/575462ba-bf67-4190-9fac-c275523c75fc",target:"_blank",rel:"noopener noreferrer"}},[e._v("[MS-OVBA] - v20210817"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.microsoft.com/en-us/openspecs/office_file_formats/ms-offcrypto/3c34d72a-1a61-4b52-a893-196f9157f083",target:"_blank",rel:"noopener noreferrer"}},[e._v("[MS-OFFCRYPTO] - v20210817"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.microsoft.com/en-us/openspecs/office_file_formats/ms-xls/cd03cb5f-ca02-4934-a391-bb674cb8aa06",target:"_blank",rel:"noopener noreferrer"}},[e._v("[MS-XLS] - v20210817"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.microsoft.com/en-us/openspecs/office_file_formats/ms-doc/ccd7b486-7881-484c-a137-51170af7cc22",target:"_blank",rel:"noopener noreferrer"}},[e._v("[MS-DOC] - v20210817"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.microsoft.com/en-us/openspecs/office_file_formats/ms-ppt/6be79dde-33c1-4c1b-8ccc-4b2301c08662",target:"_blank",rel:"noopener noreferrer"}},[e._v("[MS-PPT] - v20210817"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-oleds/85583d21-c1cf-4afe-a35f-d6701c5fbb6f",target:"_blank",rel:"noopener noreferrer"}},[e._v("[MS-OLEDS] - v20210625"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/previous-versions/office/developer/office-2007/aa338205(v=office.12)",target:"_blank",rel:"noopener noreferrer"}},[e._v("Introducing the Office (2007) Open XML File Formats"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"http://download.microsoft.com/download/5/0/1/501ED102-E53F-4CE0-AA6B-B0F93629DDC6/Office/Excel97-2007BinaryFileFormat(xls)Specification.pdf",target:"_blank",rel:"noopener noreferrer"}},[e._v("Microsoft Office Excel 97 - 2007 Binary File Format (.xls) Specification"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-oleds/fdc5e702-d09e-4344-a77f-eb079d41f23f",target:"_blank",rel:"noopener noreferrer"}},[e._v("OLE1.0 and OLE2.0 Formats"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:""}},[e._v("Microsoft Office Word 2003")])]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/en-us/previous-versions/office/aa203677(v=office.11)?redirectedfrom=MSDN",target:"_blank",rel:"noopener noreferrer"}},[e._v("Microsoft Office Word 2003 Preview"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://docs.microsoft.com/en-us/archive/msdn-magazine/2003/november/the-xml-files-xml-in-microsoft-office-word-2003",target:"_blank",rel:"noopener noreferrer"}},[e._v("The XML Files: XML in Microsoft Office Word 2003"),s("OutboundLink")],1)])])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://bbs.pediy.com/thread-218941.htm",target:"_blank",rel:"noopener noreferrer"}},[e._v("[翻译]攻击互通性-以OLE为例"),s("OutboundLink")],1)]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.blackhat.com/docs/us-15/materials/us-15-Li-Attacking-Interoperability-An-OLE-Edition.pdf",target:"_blank",rel:"noopener noreferrer"}},[e._v("Attacking Interoperability: An OLE Edition"),s("OutboundLink")],1)])])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://bbs.ichunqiu.com/thread-35164-1-1.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("宏病毒常用的一些trick"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://outflank.nl/blog/2018/10/06/old-school-evil-excel-4-0-macros-xlm/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Old school: evil Excel 4.0 macros (XLM)"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://github.com/decalage2/oletools/tree/master/oletools",target:"_blank",rel:"noopener noreferrer"}},[e._v("oletools"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[e._v("DidierStevens")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://blog.didierstevens.com/programs/oledump-py/",target:"_blank",rel:"noopener noreferrer"}},[e._v("oledump-py"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/DidierStevens/DidierStevensSuite/blob/master/oledump.py",target:"_blank",rel:"noopener noreferrer"}},[e._v("oledump.py"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://blog.didierstevens.com/2020/03/31/update-msoffcrypto-crack-py-version-0-0-5/",target:"_blank",rel:"noopener noreferrer"}},[e._v("msoffcrypto-crack.py"),s("OutboundLink")],1)])])]),e._v(" "),s("li",[s("p",[e._v("0xevilc0de")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://0xevilc0de.com/maldoc-uses-template-injection-for-macro-execution/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Maldoc uses template injection for macro execution"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://0xevilc0de.com/excel-4-macros-get-workspace-reference/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Excel 4 Macros – Get.Workspace Reference"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://0xevilc0de.com/removing-passwords-from-vba-projects/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Removing Passwords from VBA Projects"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://0xevilc0de.com/maldoc-uses-rc4-to-hide-powershell-script-retrieves-payload-from-dns-txt-record/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Maldoc uses RC4 to hide PowerShell script, retrieves payload from DNS TXT record"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://0xevilc0de.com/maldoc-uses-windows-api-to-perform-process-hollowing/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Maldoc uses Windows API to perform process hollowing"),s("OutboundLink")],1)])])]),e._v(" "),s("li",[s("p",[e._v("jstrosch")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/jstrosch/malware-samples",target:"_blank",rel:"noopener noreferrer"}},[e._v("malware-samples"),s("OutboundLink")],1)])])]),e._v(" "),s("li",[s("p",[e._v("spiderlabs")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/",target:"_blank",rel:"noopener noreferrer"}},[e._v("spiderlabs-blog"),s("OutboundLink")],1)])])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://sevrosecurity.com/2019/09/12/dynamic-office-template-injection-for-sandbox-bypass/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Template Injection"),s("OutboundLink")],1)]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/jstrosch/malware-samples/tree/master/maldocs/unknown/2020/May",target:"_blank",rel:"noopener noreferrer"}},[e._v("malware-samples: Word Doc uses Template Injection"),s("OutboundLink")],1)])])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://www.cnblogs.com/AspDotNetMVC/p/3810839.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("复合文档文件格式研究"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://blogs.vmware.com/networkvirtualization/2020/11/velvetsweatshop-when-default-passwords-can-still-make-a-difference.html/",target:"_blank",rel:"noopener noreferrer"}},[e._v("VelvetSweatshop: Default Passwords Can Still Make a Difference"),s("OutboundLink")],1)])]),e._v(" "),s("li",[s("p",[s("a",{attrs:{href:"https://docs.remnux.org/discover-the-tools/analyze+documents",target:"_blank",rel:"noopener noreferrer"}},[e._v("REMnux: Analyze Documents"),s("OutboundLink")],1)])])])])}),[],!1,null,null,null);t.default=a.exports}}]);