(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{494:function(t,e,a){t.exports=a.p+"assets/img/jaeger.a6982a28.png"},495:function(t,e,a){t.exports=a.p+"assets/img/zipkin.24fd8065.png"},698:function(t,e,a){"use strict";a.r(e);var n=a(15),r=Object(n.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"opentracing-简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#opentracing-简介"}},[t._v("#")]),t._v(" OpenTracing 简介")]),t._v(" "),n("ul",[n("li",[t._v("reference\n"),n("ul",[n("li",[n("a",{attrs:{href:"https://github.com/opentracing/specification/blob/master/specification.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("The OpenTracing Semantic Specification"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://github.com/opentracing/opentracing-go",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenTracing API for Go"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://blog.csdn.net/fei33423/article/details/79452948",target:"_blank",rel:"noopener noreferrer"}},[t._v("从Zipkin到Jaeger，Uber的分布式追踪之道tchannel"),n("OutboundLink")],1)])])])]),t._v(" "),n("h3",{attrs:{id:"opentracing-关键词"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#opentracing-关键词"}},[t._v("#")]),t._v(" opentracing 关键词")]),t._v(" "),n("ul",[n("li",[t._v("基本方法：Inject, Extract, 和 Carriers\nSpan 可以包含很多的tags、logs和baggage，但是始终需要一个高度概括的operation name")]),t._v(" "),n("li",[t._v("名词解释\n"),n("ul",[n("li",[t._v("Trace : "),n("em",[t._v("一个 trace 代表了一个事务或者流程在分布式系统中的执行过程")])]),t._v(" "),n("li",[t._v("Span : "),n("em",[t._v('一个 span 代表在分布式系统中完成的单个工作单元。也包含其他 span 的"引用"，这允许将多个 spans 组合成一个完整的 Trace')]),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("    每个 span 根据 OpenTracing 规范封装以下内容：\n        操作名称\n        开始时间和结束时间\n        span Tags key:value \n        span Logs key:value \n        SpanContext\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])]),n("ul",[n("li",[t._v("Tags : "),n("em",[t._v("Span tags(跨度标签)可以理解为用户自定义的 Span 注释。便于查询、过滤和理解跟踪数据")])]),t._v(" "),n("li",[t._v("Logs : "),n("em",[t._v("Span logs(跨度日志)可以记录 Span 内特定时间或事件的日志信息。主要用于捕获特定 Span 的日志信息以及应用程序本身的其他信息输出")])]),t._v(" "),n("li",[t._v("SpanContext : "),n("em",[t._v("SpanContext 代表跨越进程边界，传递到子级 Span 的状态。常用做在跨域API边界时的上下文传递。")])])])]),t._v(" "),n("li",[t._v("Baggage Items : "),n("em",[t._v("Baggage Items 可以理解为 trace 全局运行中额外传输的数据集合")])])])]),t._v(" "),n("li",[t._v("实现\n"),n("ul",[n("li",[t._v("grpc : 通过附加 tracer 的信息到 context 来实现跨越边界传递")]),t._v(" "),n("li",[t._v("http : 通过附加 tracer 的信息到 header 来实现跨越边界传递")])])])]),t._v(" "),n("h3",{attrs:{id:"opentracing-实现对比"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#opentracing-实现对比"}},[t._v("#")]),t._v(" opentracing 实现对比")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[t._v("产品名称")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("厂商")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("开发语言")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("OpenTracing标准")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("侵入性")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("时效性")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("决策支持")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("可视化")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("低消耗")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("延展性")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("jaeger")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("uber")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("go")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("完全")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("部分侵入")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("时效性高， UDP协议传输数据(在Uber任意给定的一个Jaeger安装可以很容易地每天处理几十亿spans)")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("决策支持较好，并且底层支持metrics指标")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("报表不丰富，UI比较简单")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("消耗低")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("jaeger比较复杂，使用框架较多。但经过uber大规模使用，延展性好")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("zipkin")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("twitter")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("java")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("部分")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("侵入性强")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("时效性好")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("决策一般(功能单一，监控维度和监控信息不够丰富。没有告警功能)")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("数据报表丰富")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("系统开销小")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("延展性好")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("skywalking")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("华为")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("java")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("完全")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("侵入性低")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("时效性好")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("虽然调用链路更细化，但作者在性能和追踪细粒度之间保持了比较好的平衡。决策好")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("数据报表丰富")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("消耗较低")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("延展性非常好，水平理论上无限扩展")])])])]),t._v(" "),n("h3",{attrs:{id:"jaeger"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jaeger"}},[t._v("#")]),t._v(" jaeger")]),t._v(" "),n("p",[n("img",{attrs:{src:a(494),alt:"jaeger"}})]),t._v(" "),n("ul",[n("li",[t._v("核心组件\n"),n("ul",[n("li",[t._v("Jaeger核心后端组件：jaeger-agent、jaeger-collector、jaeger-query")]),t._v(" "),n("li",[t._v("其中 jaeger-agent、jaeger-collector 都可以通过分布式部署 配合 LB 很容易做到横向扩展，所以对于业务体量较大的场景很有优势")])])]),t._v(" "),n("li",[t._v("持久化\n"),n("ul",[n("li",[t._v("Collectors require a persistent storage backend. Cassandra 3.x (default) and ElasticSearch are the primary supported storage backends. There is ongoing work to add support for MySQL and ScyllaDB.")])])]),t._v(" "),n("li",[t._v("采样方式\n"),n("ul",[n("li",[t._v("固定采样、随机采样、限流采样等，采样方式丰富")])])]),t._v(" "),n("li",[t._v("部署\n"),n("ul",[n("li",[t._v("all in one"),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("(不适合生产环境)\n    docker run -d -e COLLECTOR_ZIPKIN_HTTP_PORT=9411 -p 5775:5775/udp -p 6831:6831/udp -p 6832:6832/udp -p 5778:5778 -p 16686:16686 -p 14268:14268 -p 9411:9411 jaegertracing/all-in-one:latest \n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])])]),t._v(" "),n("li",[t._v("独立部署"),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("    docker run -d --rm -p 14268:14268 -p 9411:9411 jaegertracing/jaeger-collector /go/bin/collector-linux --es.server-urls=http://localhost:9200\n\n    docker run -d --rm -p 5775:5775/udp -p 6831:6831/udp -p 6832:6832/udp -p 5778:5778/tcp jaegertracing/jaeger-agent /go/bin/agent-linux --collector.host-port=jaeger-collector.jaeger-infra.svc:14267\n\n    docker run -d --rm -p 16686:16686 jaegertracing/jaeger-query /go/bin/query-linux -es.server-urls=http://localhost:9200\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])])]),t._v(" "),n("li",[t._v("端口说明"),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("    端口\t协议\t所属模块\t     功能\n    5775\tUDP\tagent\t     通过兼容性Thrift协议，接收Zipkin thrift类型数据\n    6831\tUDP\tagent\t     通过兼容性Thrift协议，接收Jaeger thrift类型数据\n    6832\tUDP\tagent\t     通过二进制Thrift协议，接收Jaeger thrift类型数据\n    5778\tHTTP\tagent\t     配置控制服务接口\n    16686\tHTTP\tquery\t     客户端前端界面展示端口\n    14268\tHTTP\tcollector    接收客户端Zipkin thrift类型数据\n    14267\tHTTP\tcollector    接收客户端Jaeger thrift类型数据\n    9411\tHTTP\tcollector    Zipkin兼容endpoint\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])])])])]),t._v(" "),n("li",[t._v("reference\n"),n("ul",[n("li",[n("a",{attrs:{href:"https://www.jaegertracing.io/docs/1.12/architecture/",target:"_blank",rel:"noopener noreferrer"}},[t._v("jaegertracing docs"),n("OutboundLink")],1)])])])]),t._v(" "),n("h3",{attrs:{id:"zipkin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#zipkin"}},[t._v("#")]),t._v(" zipkin")]),t._v(" "),n("p",[n("img",{attrs:{src:a(495),alt:"zipkin"}})]),t._v(" "),n("ul",[n("li",[t._v("持久化\n"),n("ul",[n("li",[t._v("Cassandra、ElasticSearch和MySQL")])])]),t._v(" "),n("li",[t._v("采样方式\n"),n("ul",[n("li",[t._v("随机概率采样")])])]),t._v(" "),n("li",[t._v("zikpin 使用示例(可以自己实现grpc.StatsHandler来定制化功能)："),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('    import (\n        zipkin "github.com/openzipkin/zipkin-go"\n        zipkingrpc "github.com/openzipkin/zipkin-go/middleware/grpc"\n        zipkinrephttp "github.com/openzipkin/zipkin-go/reporter/http"\n    )\n\n    func client() {\n        opts := []grpc.DialOption{\n            grpc.WithInsecure(),\n            func() grpc.DialOption {\n                tracer, _ := zipkin.NewTracer(zipkinrephttp.NewReporter("http://127.0.0.1:9411/api/v2/spans"),  zipkin.WithSampler(zipkin.AlwaysSample))\n                return grpc.WithStatsHandler(zipkingrpc.NewClientHandler(tracer))\n            }()\n        }\n        conn, err := grpc.Dial(fmt.Sprintf("%v:%v", svcData.Address, svcData.Port), opts ...)\n        ...\n    } \n\n    func server() {\n        tracer, _ := zipkin.NewTracer(zipkinrephttp.NewReporter("http://127.0.0.1:9411/api/v2/spans"), zipkin.WithSampler(zipkin.AlwaysSample))\n        opt = append(opt, grpc.StatsHandler(zipkingrpc.NewServerHandler(tracer)))\n        ...\n        wserver.Server = grpc.NewServer(opt...)\n    } \n')])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br")])])])])])}),[],!1,null,null,null);e.default=r.exports}}]);