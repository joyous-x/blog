(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{674:function(s,n,a){"use strict";a.r(n);var t=a(16),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"cxx-traps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cxx-traps"}},[s._v("#")]),s._v(" Cxx Traps")]),s._v(" "),a("p",[s._v("c/c++ 源代码一般会通过以下步骤，被编译、链接成可执行文件：")]),s._v(" "),a("ol",[a("li",[s._v("预处理(Preprocess) : "),a("code",[s._v("gcc -E test.cpp -o test.i")])]),s._v(" "),a("li",[s._v("编译为汇编(Compilation): "),a("code",[s._v("gcc -S test.i -o test.s")])]),s._v(" "),a("li",[s._v("汇编(Assembly): "),a("code",[s._v("gcc -c test.s -o test.o")])]),s._v(" "),a("li",[s._v("连接(Linking): "),a("code",[s._v("gcc test.o -o test")])])]),s._v(" "),a("p",[s._v("当然，上述步骤可以直接通过 "),a("code",[s._v("gcc define.cpp test.cpp -o test")]),s._v(" 一步到位.")]),s._v(" "),a("h2",{attrs:{id:"_1-enum"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-enum"}},[s._v("#")]),s._v(" 1. Enum")]),s._v(" "),a("h3",{attrs:{id:"_1-1-疑问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-疑问"}},[s._v("#")]),s._v(" 1.1 疑问")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('class Test {\npublic:\n    enum Result {\n        Result_OK = 0x1000,\n    };\n\n    Test(enum Result emRst) {\n        m_nRst = emRst;\n    }\n\n    static int m_nRst;\n};\n\nint Test::m_nRst = 0; /* OK */\n// Test::m_nRst = 0; /* ERROR, 此声明没有存储类或类型说明符 */\n\nint main() { \n    Test(Test::Result(Test::Result_OK)); /* OK */\n    Test((Test::Result)Test::Result_OK); /* OK */\n    // Test(Test::Result_OK); /* ERROR, 当前范围内无法定义 constant "Test::Result_OK" */\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[a("strong",[s._v('为什么上述代码在去掉注释"//"后，vs2019编译器会提示错误？')])]),s._v(" "),a("h3",{attrs:{id:"_1-2-背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-背景"}},[s._v("#")]),s._v(" 1.2 背景")]),s._v(" "),a("p",[s._v("我们需要明白，enum 关键字会定义一个类型，同时，其内定义的项目会被展开为int型常量到定义 enum 的作用域。")]),s._v(" "),a("p",[s._v("这会造成，在全局位置定义的 enum 类型中的项目名需要是全局唯一的, 如下述定义会编译出错("),a("em",[s._v("error C2365: “a”: 重定义")]),s._v(")：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("enum X { a };\nenum Y { a };\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("由此，为了解决"),a("strong",[s._v("作用域 以及 强类型限定")]),s._v("问题，"),a("strong",[s._v("C++11 中引入了 enum class 或 enum struct")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"_1-3-解答"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-解答"}},[s._v("#")]),s._v(" 1.3 解答")]),s._v(" "),a("ol",[a("li",[s._v("全局位置的 "),a("em",[s._v("ERROR, 此声明没有存储类或类型说明符")]),s._v("：\n"),a("ul",[a("li",[s._v("c/c++ 没有全局代码块，在全局位置的是 "),a("strong",[s._v("声明或定义")])])])]),s._v(" "),a("li",[s._v("传递枚举值到枚举类型参数时 "),a("em",[s._v("ERROR, 当前范围内无法定义 constant")]),s._v("：\n"),a("ul",[a("li",[s._v("？")]),s._v(" "),a("li",[s._v("vs2019 会报错，但，g++ 在 linux 下编译正常\n"),a("ul",[a("li",[s._v("可能是：强类型限定造成现在拒绝枚举量与int之间的隐式转换")])])])])])]),s._v(" "),a("h2",{attrs:{id:"_2-array-pointer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-array-pointer"}},[s._v("#")]),s._v(" 2. Array & Pointer")]),s._v(" "),a("h3",{attrs:{id:"_2-1-疑问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-疑问"}},[s._v("#")]),s._v(" 2.1 疑问")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// define.c\nint arr[] = { 1,2,3 };\nint* ard = &arr[0];\n\n// test.c\nint art[] = { 5,6,7,8,9 };\nextern int* arr;\n\nvoid test() {\n    int* x = arr + 1;\n    int* m = arrx + 1;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("请问 test 函数中的 x 和 m 分别是多少？(int)x = 5, *m = 6")]),s._v(" "),a("p",[s._v("同我们的认知："),a("strong",[s._v("数组可以当成指针使用")]),s._v(" 不一样，对吧...")]),s._v(" "),a("h3",{attrs:{id:"_2-2-解答"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-解答"}},[s._v("#")]),s._v(" 2.2 解答")]),s._v(" "),a("p",[s._v("将上述代码编译成汇编后的代码如下：")]),s._v(" "),a("ul",[a("li",[s._v("define.cpp")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('        .file   "define.cpp"\n        .text\n        .globl  arr\n        .data\n        .align 8\n        .type   arr, @object\n        .size   arr, 12\narr:\n        .long   1\n        .long   2\n        .long   3\n        .globl  arm\n        .section        .data.rel.local,"aw"\n        .align 8\n        .type   arm, @object\n        .size   arm, 8\narm:\n        .quad   arr\n        .ident  "GCC: (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0"\n        .section        .note.GNU-stack,"",@progbits\n        .section        .note.gnu.property,"a"\n        .align 8\n        .long    1f - 0f\n        .long    4f - 1f\n        .long    5\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("ul",[a("li",[s._v("test.cpp")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('        .file   "test.cpp"\n        .text\n        .globl  art\n        .data\n        .align 16\n        .type   art, @object\n        .size   art, 20\nart:\n        .long   5\n        .long   6\n        .long   7\n        .long   8\n        .long   9\n        .text\n        .globl  test\n        .type   test, @function\ntest:\n.LFB0:\n        .cfi_startproc\n        endbr64\n        pushq   %rbp\n        .cfi_def_cfa_offset 16\n        .cfi_offset 6, -16\n        movq    %rsp, %rbp\n        .cfi_def_cfa_register 6\n        movq    arr(%rip), %rax\n        addq    $4, %rax\n        movq    %rax, -16(%rbp)\n        leaq    4+art(%rip), %rax\n        movq    %rax, -8(%rbp)\n        movq    -8(%rbp), %rax\n        movl    (%rax), %eax\n        movl    %eax, -20(%rbp)\n        nop\n        popq    %rbp\n        .cfi_def_cfa 7, 8\n        ret\n        .cfi_endproc\n.LFE0:\n        .size   test, .-test\n        .ident  "GCC: (Ubuntu 9.3.0-17ubuntu1~20.04) 9.3.0"\n        .section        .note.GNU-stack,"",@progbits\n        .section        .note.gnu.property,"a"\n        .align 8\n        .long    1f - 0f\n        .long    4f - 1f\n        .long    5\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br")])]),a("p",[s._v("观察：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("define.cpp")]),s._v("中 arr 和 arm 的定义")]),s._v(" "),a("li",[a("code",[s._v("test.cpp")]),s._v("中 arr(%rip) 和 art(%rip) 的操作")])]),s._v(" "),a("p",[s._v("可以发现：")]),s._v(" "),a("ol",[a("li",[s._v("数组可以当成指针使用，的原因是："),a("strong",[s._v("编译器帮忙做了取地址操作")])]),s._v(" "),a("li",[s._v("因为 "),a("code",[s._v("extern int* arr")]),s._v(" 在使用时"),a("strong",[s._v("缺少了")]),s._v("编译器帮忙做"),a("em",[s._v("取地址操作")]),s._v("这一动作，直接被把 arr 当成了 指针使用：具体的方式可以参考 arm 的定义："),a("strong",[s._v("直接把 arm 的值当成了地址使用")])])]),s._v(" "),a("h2",{attrs:{id:"_3-single-parameter-constructor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-single-parameter-constructor"}},[s._v("#")]),s._v(" 3. Single Parameter Constructor")]),s._v(" "),a("p",[s._v("C++中单参数构造函数是可以被隐式调用的，主要有两种情形会隐式调用单参数构造函数:")]),s._v(" "),a("ul",[a("li",[s._v("同类型对象的拷贝构造\n"),a("ul",[a("li",[s._v("即用相同类型的其它对象来初始化当前对象")])])]),s._v(" "),a("li",[s._v("不同类型对象的隐式转换\n"),a("ul",[a("li",[s._v("即其它类型对象隐式调用单参数拷贝构造函数初始化当前对象。比如 A a=1; 就是隐式转换，而不是显示调用构造函数，即A a(1); 像 A(1) 这种涉及类型转换的单参数构造函数，又被称为转换构造函数(Converting Constructor)")])])])]),s._v(" "),a("p",[s._v("可以通过 explict 关键字避免这种隐式调用。")]),s._v(" "),a("h2",{attrs:{id:"_4-todo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-todo"}},[s._v("#")]),s._v(" 4. TODO")])])}),[],!1,null,null,null);n.default=e.exports}}]);