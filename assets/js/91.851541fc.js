(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{713:function(s,n,e){"use strict";e.r(n);var a=e(15),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"实践-dind"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实践-dind"}},[s._v("#")]),s._v(" 实践：DIND")]),s._v(" "),e("h2",{attrs:{id:"registry"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#registry"}},[s._v("#")]),s._v(" registry")]),s._v(" "),e("ul",[e("li",[s._v("run\n"),e("ul",[e("li",[s._v("docker run -d -p 5000:5000 -v /tmp/registry:/registry --name registry registry")])])]),s._v(" "),e("li",[s._v("watch\n"),e("ul",[e("li",[s._v("http://127.0.0.1:5000/v2/_catalog")])])]),s._v(" "),e("li",[s._v("test\n"),e("ul",[e("li",[s._v("docker build -t localhost:5000/containersol/nodejs_app")]),s._v(" "),e("li",[s._v("docker push localhost:5000/containersol/nodejs_app")])])])]),s._v(" "),e("h2",{attrs:{id:"jenkins"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jenkins"}},[s._v("#")]),s._v(" jenkins")]),s._v(" "),e("ul",[e("li",[s._v("build\n"),e("ul",[e("li",[s._v("docker build -t containersol/jenkins_with_docker -f dockerfile_jenkins .")])])]),s._v(" "),e("li",[s._v("run\n"),e("ul",[e("li",[s._v("docker run -d -p 8081:8080 -v /var/run/docker.sock:/var/run/docker.sock -v $(which docker):/usr/bin/docker  -v $(pwd):/var/jenkins_data -v jenkins-stuff:/var/jenkins_home --name jenkins containersol/jenkins_with_docker")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("    -v /usr/lib64/libltdl.so.7:/usr/lib/x86_64-linux-gnu/libltdl.so.7\n    --user jenkins\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])]),s._v(" "),e("li",[s._v("test\n"),e("ul",[e("li",[s._v("docker exec -it --user jenkins [container_id] /bin/bash")]),s._v(" "),e("li",[s._v("docker build -t localhost:5000/containersol/nodejs_app:v2 -f /var/jenkins_data/dockerfile_nodejs /var/jenkins_data")])])]),s._v(" "),e("li",[s._v("note\n"),e("ul",[e("li",[s._v("一定要保证：在 dockerfile_jenkins 中, RUN groupadd -g 980 docker, 时的 gid(980) 和 宿主机的docker组gid一致")])])]),s._v(" "),e("li",[s._v("watch\n"),e("ul",[e("li",[s._v("http://127.0.0.1:8081")])])])]),s._v(" "),e("h2",{attrs:{id:"appendix-相关文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#appendix-相关文件"}},[s._v("#")]),s._v(" Appendix: 相关文件")]),s._v(" "),e("blockquote",[e("p",[s._v("app.js")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('// Load the http module to create an http server.\nvar http = require(\'http\');\n\n// Configure our HTTP server to respond with Hello World to all requests.\nvar server = http.createServer(function (request, response) {\nresponse.writeHead(200, {"Content-Type": "text/plain"});\nresponse.end("Hello World\\n");\n});\n\n// Listen on port 8000, IP defaults to "0.0.0.0"\nserver.listen(8000);\n\n// Put a friendly message on the terminal\nconsole.log("Server running at http://127.0.0.1:8000/");\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("blockquote",[e("p",[s._v("build.sh")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('#!/bin/bash\n\nif [ -z "${1}" ]; then\nversion="latest"\nelse\nversion="${1}"\nfi\n\ncd nodejs_app\ndocker build -t localhost:5000/containersol/nodejs_app:${version} .\ncd ..\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("blockquote",[e("p",[s._v("push.sh")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('#!/bin/bash\n\nif [ -z "${1}" ]; then\nversion="latest"\nelse\nversion="${1}"\nfi\n\ndocker push localhost:5000/containersol/nodejs_app:"${version}"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("blockquote",[e("p",[s._v("start.sh")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#!/bin/bash\n\n# http://127.0.0.1:8000/\n\ndocker build -t my_nodejs_image .\ndocker run -p 8000:8000 my_nodejs_image\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("blockquote",[e("p",[s._v("dockerfile_jenkins")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("FROM jenkins\n\nMAINTAINER ContainerSolutions\n\nUSER root\n#TODO the group ID for docker group on my Ubuntu is 125, therefore I can only run docker commands if I have same group id inside. \n# Otherwise the socket file is not accessible.\nRUN groupadd -g 980 docker && usermod -a -G docker jenkins \nUSER jenkins\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("blockquote",[e("p",[s._v("dockerfile_nodejs")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('FROM google/nodejs\n\nWORKDIR /app\nADD package.json /app/\nRUN npm install\nADD . /app\n\nEXPOSE 8000\nCMD []\nENTRYPOINT ["/nodejs/bin/npm", "start"]\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])]),e("blockquote",[e("p",[s._v("package.json")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('{\n    "name": "hello-world",\n    "description": "hello world",\n    "version": "0.0.1",\n    "private": true,\n    "dependencies": {\n        "express": "3.x"\n    },\n    "scripts": {"start": "node app.js"}\n}\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);