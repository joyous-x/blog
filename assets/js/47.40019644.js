(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{571:function(n,s,t){"use strict";t.r(s);var a=t(15),e=Object(a.a)({},(function(){var n=this,s=n.$createElement,t=n._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[t("h1",{attrs:{id:"recover-const-简述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#recover-const-简述"}},[n._v("#")]),n._v(" recover & const 简述")]),n._v(" "),t("h2",{attrs:{id:"const类型转换"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#const类型转换"}},[n._v("#")]),n._v(" const类型转换")]),n._v(" "),t("ul",[t("li",[t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('\tpackage main\n\timport (\n\t\t"fmt"\n\t\t"reflect"\n\t\t"time"\n\t)\n\tconst a = 1\n\tfunc test(a time.Duration) {\n\t\tfmt.Printf("%v \\n", a)\n\t}\n\tfunc main() {\n\t\tb := a + 1\n\t\tfmt.Printf("---- a = %v \\n", reflect.TypeOf(a))\n\t\ttest(a)\n\t\tfmt.Printf("---- b = %v \\n", reflect.TypeOf(b))\n\t\t// test(b)  //> 打开注释后, 会编译不通过\n\t}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('\tpackage main\n\timport (\n\t\t"fmt"\n\t\t"reflect"\n\t\t"time"\n\t)\n\tconst a = 1\n\tfunc test(a time.Duration) {\n\t\tfmt.Printf("%v \\n", a)\n\t}\n\tfunc main() {\n\t\tb := a + 1\n\t\tfmt.Printf("---- a = %v \\n", reflect.TypeOf(a))\n\t\ttest(a)\n\t\tfmt.Printf("---- b = %v \\n", reflect.TypeOf(b))\n\t\t// test(b)  //> 打开注释后, 会编译不通过\n\t}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br")])]),n._v("问题"),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('\tpackage main\n\timport (\n\t\t"fmt"\n\t\t"reflect"\n\t\t"time"\n\t)\n\tconst a = 1\n\tfunc test(a time.Duration) {\n\t\tfmt.Printf("%v \\n", a)\n\t}\n\tfunc main() {\n\t\tb := a + 1\n\t\tfmt.Printf("---- a = %v \\n", reflect.TypeOf(a))\n\t\ttest(a)\n\t\tfmt.Printf("---- b = %v \\n", reflect.TypeOf(b))\n\t\t// test(b)  //> 打开注释后, 会编译不通过\n\t}\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br")])])]),n._v(" "),t("li",[t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("Assignability\n\tA value x is assignable to a variable of type T (\"x is assignable to T\") if one of the following conditions applies:\n\t\t- x's type is identical to T.\n\t\t- x's type V and T have identical underlying types and at least one of V or T is not a defined type.\n\t\t- T is an interface type and x implements T.\n\t\t- x is a bidirectional channel value, T is a channel type, x's type V and T have identical element types, and at least one of V or T is not a defined type.\n\t\t- x is the predeclared identifier nil and T is a pointer, function, slice, map, channel, or interface type.\n\t\t- x is an untyped constant representable by a value of type T.\t\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br")])]),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("Assignability\n\tA value x is assignable to a variable of type T (\"x is assignable to T\") if one of the following conditions applies:\n\t\t- x's type is identical to T.\n\t\t- x's type V and T have identical underlying types and at least one of V or T is not a defined type.\n\t\t- T is an interface type and x implements T.\n\t\t- x is a bidirectional channel value, T is a channel type, x's type V and T have identical element types, and at least one of V or T is not a defined type.\n\t\t- x is the predeclared identifier nil and T is a pointer, function, slice, map, channel, or interface type.\n\t\t- x is an untyped constant representable by a value of type T.\t\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br")])]),n._v("原因"),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v("Assignability\n\tA value x is assignable to a variable of type T (\"x is assignable to T\") if one of the following conditions applies:\n\t\t- x's type is identical to T.\n\t\t- x's type V and T have identical underlying types and at least one of V or T is not a defined type.\n\t\t- T is an interface type and x implements T.\n\t\t- x is a bidirectional channel value, T is a channel type, x's type V and T have identical element types, and at least one of V or T is not a defined type.\n\t\t- x is the predeclared identifier nil and T is a pointer, function, slice, map, channel, or interface type.\n\t\t- x is an untyped constant representable by a value of type T.\t\n")])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br")])]),t("ul",[t("li",[n._v("const 修饰的变量如果没有明确指明类型时，会根据需要做类型转换; 而非 const 修饰的变量不会。")]),n._v(" "),t("li",[n._v("reference: "),t("a",{attrs:{href:"https://golang.org/ref/spec#Constants",target:"_blank",rel:"noopener noreferrer"}},[n._v("https://golang.org/ref/spec#Constants"),t("OutboundLink")],1)])])])]),n._v(" "),t("h2",{attrs:{id:"defer-panic-recover"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#defer-panic-recover"}},[n._v("#")]),n._v(" defer & panic & recover")]),n._v(" "),t("ul",[t("li",[n._v("详述\n"),t("ul",[t("li",[n._v("defer\n"),t("ul",[t("li",[n._v("工作方式：先进后出")]),n._v(" "),t("li",[n._v("执行时机：\n"),t("ul",[t("li",[n._v("先说 return语句的处理过程\n"),t("ul",[t("li",[n._v("return xxx 语句并不是一条原子指令，在执行时会分解成： a、返回变量=xxx b、执行return")])])]),n._v(" "),t("li",[n._v("defer语句是在函数关闭时调用，确切的说是紧贴在执行return语句之前调用。\n"),t("ul",[t("li",[n._v("注意，是return 不是return xxx，就是说 defer 发生在上述流程的 a 和 b 之间。")])])])])])])]),n._v(" "),t("li",[n._v("panic\n"),t("ul",[t("li",[n._v("执行过程：\n"),t("ul",[t("li",[n._v("当执行一个函数 F 的时候，如果显式地调用 panic 函数或者一个 run-time panics 发生时，F 会结束运行，所有 F 中 defer 的函数会按照 FILO 的规则被执行。")]),n._v(" "),t("li",[n._v("之后，F 函数的调用者中 defer 的函数再被执行，如此一直到最外层代码或者有效的 recover 调用。")])])]),n._v(" "),t("li",[n._v("panic 函数的参数是空接口类型，所以可以接受任何类型的对象")])])]),n._v(" "),t("li",[n._v("recover\n"),t("ul",[t("li",[n._v("目的：\n"),t("ul",[t("li",[n._v("当一个 goroutine 发生 panic 时，不影响其他的 goroutines 的执行")])])]),n._v(" "),t("li",[n._v("执行时机：\n"),t("ul",[t("li",[n._v("recover 函数用来获取 panic 函数的参数信息，只能在延时调用 defer 语句调用的函数中"),t("strong",[n._v("直接调用")]),n._v("才能生效")]),n._v(" "),t("li",[n._v("如果在 defer 语句中也调用 panic 函数，则只有最后一个被调用的 panic 函数的参数会被 recover 函数获取到。")]),n._v(" "),t("li",[n._v("如果 goroutine 没有 panic，那调用 recover 函数会返回 nil。")])])])])])])])]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('package main\n\nimport (\n\t"fmt"\n\t"runtime"\n\t"sync"\n\t"time"\n)\n\n/**\n*\n\n预期：\n   我们预期，定时器不停的工作，但当 goroutine 发生 panic 时，虽然不会影响其他 goroutine 但会造成定时器退出，不再继续工作\n伪码：\n   go func() {\n       defer func() {\n           if err := recover(); err != nil {\n               stackData := make([]byte, 1<<16)\n               runtime.Stack(stackData, false)\n               fmt.Printf("%v \\n", string(stackData))\n           }\n       }\n       ticker := time.NewTicker(1 * time.Second)\n       for range ticker.C {\n           var wg sync.WaitGroup\n           go func() {\n               //> do somethings\n           }\n           for i := 0; i < 100; i++ {\n               wg.Add(1)\n               go func() {\n                   defer wg.Done()\n                   //> do somethings\n               }\n           }\n           wg.Wait()\n       }\n   }\n\n*/\n\nfunc recovery(source string) {\n\tif err := recover(); err != nil { // recover只在defer的函数中有效\n\t\tfmt.Printf("-- %v \\n", err)\n\t\tstackData := make([]byte, 1<<16)\n\t\truntime.Stack(stackData, false)\n\t\tfmt.Printf("src=%s: %v \\n", source, string(stackData))\n\t} else {\n\t\tfmt.Printf("i am recovery: no : src=%s\\n", source)\n\t}\n}\n\nfunc firstCrash() {\n\tdefer func() {\n\t\tfmt.Printf("i am firstCrash: defer \\n")\n\t\t//> 这里的 recover 生效\n\t\tif err := recover(); err != nil {\n\t\t\tfmt.Printf("i am firstCrash: recovery \\n")\n\t\t}\n\t}()\n\tpanic("~~ panic ~~")\n}\n\nfunc nextCrash() {\n\tdefer func() {\n\t\tfmt.Printf("i am nextCrash: defer \\n")\n\t\trecovery("nextCrash") //> 这里的 recovery 里的 recover 不生效: recover 只在 defer 函数里才生效\n\t}()\n\tpanic("~~ panic ~~")\n}\n\nfunc next(w *sync.WaitGroup) {\n\tdefer w.Done()\n\tfmt.Printf("-- next: body \\n")\n\tnextCrash()\n}\n\nfunc first(w *sync.WaitGroup) {\n\tw.Add(1)\n\tgo func() {\n\t\tdefer recovery("first")\n\t\ttime.Sleep(1 * time.Second)\n\t\tfirstCrash()\n\t\tfmt.Printf("i am first: b \\n")\n\t\tnext(w)\n\t}()\n}\n\nfunc main() {\n\tdefer recovery("main")\n\tvar wg sync.WaitGroup\n\tfirst(&wg)\n\tfmt.Printf("i am wait \\n")\n\twg.Wait()\n\ttime.Sleep(2 * time.Second)\n\tfmt.Printf("i am ending \\n")\n}\n\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br"),t("span",{staticClass:"line-number"},[n._v("34")]),t("br"),t("span",{staticClass:"line-number"},[n._v("35")]),t("br"),t("span",{staticClass:"line-number"},[n._v("36")]),t("br"),t("span",{staticClass:"line-number"},[n._v("37")]),t("br"),t("span",{staticClass:"line-number"},[n._v("38")]),t("br"),t("span",{staticClass:"line-number"},[n._v("39")]),t("br"),t("span",{staticClass:"line-number"},[n._v("40")]),t("br"),t("span",{staticClass:"line-number"},[n._v("41")]),t("br"),t("span",{staticClass:"line-number"},[n._v("42")]),t("br"),t("span",{staticClass:"line-number"},[n._v("43")]),t("br"),t("span",{staticClass:"line-number"},[n._v("44")]),t("br"),t("span",{staticClass:"line-number"},[n._v("45")]),t("br"),t("span",{staticClass:"line-number"},[n._v("46")]),t("br"),t("span",{staticClass:"line-number"},[n._v("47")]),t("br"),t("span",{staticClass:"line-number"},[n._v("48")]),t("br"),t("span",{staticClass:"line-number"},[n._v("49")]),t("br"),t("span",{staticClass:"line-number"},[n._v("50")]),t("br"),t("span",{staticClass:"line-number"},[n._v("51")]),t("br"),t("span",{staticClass:"line-number"},[n._v("52")]),t("br"),t("span",{staticClass:"line-number"},[n._v("53")]),t("br"),t("span",{staticClass:"line-number"},[n._v("54")]),t("br"),t("span",{staticClass:"line-number"},[n._v("55")]),t("br"),t("span",{staticClass:"line-number"},[n._v("56")]),t("br"),t("span",{staticClass:"line-number"},[n._v("57")]),t("br"),t("span",{staticClass:"line-number"},[n._v("58")]),t("br"),t("span",{staticClass:"line-number"},[n._v("59")]),t("br"),t("span",{staticClass:"line-number"},[n._v("60")]),t("br"),t("span",{staticClass:"line-number"},[n._v("61")]),t("br"),t("span",{staticClass:"line-number"},[n._v("62")]),t("br"),t("span",{staticClass:"line-number"},[n._v("63")]),t("br"),t("span",{staticClass:"line-number"},[n._v("64")]),t("br"),t("span",{staticClass:"line-number"},[n._v("65")]),t("br"),t("span",{staticClass:"line-number"},[n._v("66")]),t("br"),t("span",{staticClass:"line-number"},[n._v("67")]),t("br"),t("span",{staticClass:"line-number"},[n._v("68")]),t("br"),t("span",{staticClass:"line-number"},[n._v("69")]),t("br"),t("span",{staticClass:"line-number"},[n._v("70")]),t("br"),t("span",{staticClass:"line-number"},[n._v("71")]),t("br"),t("span",{staticClass:"line-number"},[n._v("72")]),t("br"),t("span",{staticClass:"line-number"},[n._v("73")]),t("br"),t("span",{staticClass:"line-number"},[n._v("74")]),t("br"),t("span",{staticClass:"line-number"},[n._v("75")]),t("br"),t("span",{staticClass:"line-number"},[n._v("76")]),t("br"),t("span",{staticClass:"line-number"},[n._v("77")]),t("br"),t("span",{staticClass:"line-number"},[n._v("78")]),t("br"),t("span",{staticClass:"line-number"},[n._v("79")]),t("br"),t("span",{staticClass:"line-number"},[n._v("80")]),t("br"),t("span",{staticClass:"line-number"},[n._v("81")]),t("br"),t("span",{staticClass:"line-number"},[n._v("82")]),t("br"),t("span",{staticClass:"line-number"},[n._v("83")]),t("br"),t("span",{staticClass:"line-number"},[n._v("84")]),t("br"),t("span",{staticClass:"line-number"},[n._v("85")]),t("br"),t("span",{staticClass:"line-number"},[n._v("86")]),t("br"),t("span",{staticClass:"line-number"},[n._v("87")]),t("br"),t("span",{staticClass:"line-number"},[n._v("88")]),t("br"),t("span",{staticClass:"line-number"},[n._v("89")]),t("br"),t("span",{staticClass:"line-number"},[n._v("90")]),t("br"),t("span",{staticClass:"line-number"},[n._v("91")]),t("br"),t("span",{staticClass:"line-number"},[n._v("92")]),t("br"),t("span",{staticClass:"line-number"},[n._v("93")]),t("br"),t("span",{staticClass:"line-number"},[n._v("94")]),t("br"),t("span",{staticClass:"line-number"},[n._v("95")]),t("br"),t("span",{staticClass:"line-number"},[n._v("96")]),t("br"),t("span",{staticClass:"line-number"},[n._v("97")]),t("br"),t("span",{staticClass:"line-number"},[n._v("98")]),t("br"),t("span",{staticClass:"line-number"},[n._v("99")]),t("br")])]),t("blockquote",[t("p",[n._v("sample code")])]),n._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('package main\n\nimport (\n\t"fmt"\n\t"runtime"\n\t"sync"\n\t"time"\n)\n\n/**\n*\n\n预期：\n   我们预期，定时器不停的工作，但当 goroutine 发生 panic 时，虽然不会影响其他 goroutine 但会造成定时器退出，不再继续工作\n伪码：\n   go func() {\n       defer func() {\n           if err := recover(); err != nil {\n               stackData := make([]byte, 1<<16)\n               runtime.Stack(stackData, false)\n               fmt.Printf("%v \\n", string(stackData))\n           }\n       }\n       ticker := time.NewTicker(1 * time.Second)\n       for range ticker.C {\n           var wg sync.WaitGroup\n           go func() {\n               //> do somethings\n           }\n           for i := 0; i < 100; i++ {\n               wg.Add(1)\n               go func() {\n                   defer wg.Done()\n                   //> do somethings\n               }\n           }\n           wg.Wait()\n       }\n   }\n\n*/\n\nfunc recovery(source string) {\n\tif err := recover(); err != nil { // recover只在defer的函数中有效\n\t\tfmt.Printf("-- %v \\n", err)\n\t\tstackData := make([]byte, 1<<16)\n\t\truntime.Stack(stackData, false)\n\t\tfmt.Printf("src=%s: %v \\n", source, string(stackData))\n\t} else {\n\t\tfmt.Printf("i am recovery: no : src=%s\\n", source)\n\t}\n}\n\nfunc firstCrash() {\n\tdefer func() {\n\t\tfmt.Printf("i am firstCrash: defer \\n")\n\t\t//> 这里的 recover 生效\n\t\tif err := recover(); err != nil {\n\t\t\tfmt.Printf("i am firstCrash: recovery \\n")\n\t\t}\n\t}()\n\tpanic("~~ panic ~~")\n}\n\nfunc nextCrash() {\n\tdefer func() {\n\t\tfmt.Printf("i am nextCrash: defer \\n")\n\t\trecovery("nextCrash") //> 这里的 recovery 里的 recover 不生效: recover 只在 defer 函数里才生效\n\t}()\n\tpanic("~~ panic ~~")\n}\n\nfunc next(w *sync.WaitGroup) {\n\tdefer w.Done()\n\tfmt.Printf("-- next: body \\n")\n\tnextCrash()\n}\n\nfunc first(w *sync.WaitGroup) {\n\tw.Add(1)\n\tgo func() {\n\t\tdefer recovery("first")\n\t\ttime.Sleep(1 * time.Second)\n\t\tfirstCrash()\n\t\tfmt.Printf("i am first: b \\n")\n\t\tnext(w)\n\t}()\n}\n\nfunc main() {\n\tdefer recovery("main")\n\tvar wg sync.WaitGroup\n\tfirst(&wg)\n\tfmt.Printf("i am wait \\n")\n\twg.Wait()\n\ttime.Sleep(2 * time.Second)\n\tfmt.Printf("i am ending \\n")\n}\n\n')])]),n._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[n._v("1")]),t("br"),t("span",{staticClass:"line-number"},[n._v("2")]),t("br"),t("span",{staticClass:"line-number"},[n._v("3")]),t("br"),t("span",{staticClass:"line-number"},[n._v("4")]),t("br"),t("span",{staticClass:"line-number"},[n._v("5")]),t("br"),t("span",{staticClass:"line-number"},[n._v("6")]),t("br"),t("span",{staticClass:"line-number"},[n._v("7")]),t("br"),t("span",{staticClass:"line-number"},[n._v("8")]),t("br"),t("span",{staticClass:"line-number"},[n._v("9")]),t("br"),t("span",{staticClass:"line-number"},[n._v("10")]),t("br"),t("span",{staticClass:"line-number"},[n._v("11")]),t("br"),t("span",{staticClass:"line-number"},[n._v("12")]),t("br"),t("span",{staticClass:"line-number"},[n._v("13")]),t("br"),t("span",{staticClass:"line-number"},[n._v("14")]),t("br"),t("span",{staticClass:"line-number"},[n._v("15")]),t("br"),t("span",{staticClass:"line-number"},[n._v("16")]),t("br"),t("span",{staticClass:"line-number"},[n._v("17")]),t("br"),t("span",{staticClass:"line-number"},[n._v("18")]),t("br"),t("span",{staticClass:"line-number"},[n._v("19")]),t("br"),t("span",{staticClass:"line-number"},[n._v("20")]),t("br"),t("span",{staticClass:"line-number"},[n._v("21")]),t("br"),t("span",{staticClass:"line-number"},[n._v("22")]),t("br"),t("span",{staticClass:"line-number"},[n._v("23")]),t("br"),t("span",{staticClass:"line-number"},[n._v("24")]),t("br"),t("span",{staticClass:"line-number"},[n._v("25")]),t("br"),t("span",{staticClass:"line-number"},[n._v("26")]),t("br"),t("span",{staticClass:"line-number"},[n._v("27")]),t("br"),t("span",{staticClass:"line-number"},[n._v("28")]),t("br"),t("span",{staticClass:"line-number"},[n._v("29")]),t("br"),t("span",{staticClass:"line-number"},[n._v("30")]),t("br"),t("span",{staticClass:"line-number"},[n._v("31")]),t("br"),t("span",{staticClass:"line-number"},[n._v("32")]),t("br"),t("span",{staticClass:"line-number"},[n._v("33")]),t("br"),t("span",{staticClass:"line-number"},[n._v("34")]),t("br"),t("span",{staticClass:"line-number"},[n._v("35")]),t("br"),t("span",{staticClass:"line-number"},[n._v("36")]),t("br"),t("span",{staticClass:"line-number"},[n._v("37")]),t("br"),t("span",{staticClass:"line-number"},[n._v("38")]),t("br"),t("span",{staticClass:"line-number"},[n._v("39")]),t("br"),t("span",{staticClass:"line-number"},[n._v("40")]),t("br"),t("span",{staticClass:"line-number"},[n._v("41")]),t("br"),t("span",{staticClass:"line-number"},[n._v("42")]),t("br"),t("span",{staticClass:"line-number"},[n._v("43")]),t("br"),t("span",{staticClass:"line-number"},[n._v("44")]),t("br"),t("span",{staticClass:"line-number"},[n._v("45")]),t("br"),t("span",{staticClass:"line-number"},[n._v("46")]),t("br"),t("span",{staticClass:"line-number"},[n._v("47")]),t("br"),t("span",{staticClass:"line-number"},[n._v("48")]),t("br"),t("span",{staticClass:"line-number"},[n._v("49")]),t("br"),t("span",{staticClass:"line-number"},[n._v("50")]),t("br"),t("span",{staticClass:"line-number"},[n._v("51")]),t("br"),t("span",{staticClass:"line-number"},[n._v("52")]),t("br"),t("span",{staticClass:"line-number"},[n._v("53")]),t("br"),t("span",{staticClass:"line-number"},[n._v("54")]),t("br"),t("span",{staticClass:"line-number"},[n._v("55")]),t("br"),t("span",{staticClass:"line-number"},[n._v("56")]),t("br"),t("span",{staticClass:"line-number"},[n._v("57")]),t("br"),t("span",{staticClass:"line-number"},[n._v("58")]),t("br"),t("span",{staticClass:"line-number"},[n._v("59")]),t("br"),t("span",{staticClass:"line-number"},[n._v("60")]),t("br"),t("span",{staticClass:"line-number"},[n._v("61")]),t("br"),t("span",{staticClass:"line-number"},[n._v("62")]),t("br"),t("span",{staticClass:"line-number"},[n._v("63")]),t("br"),t("span",{staticClass:"line-number"},[n._v("64")]),t("br"),t("span",{staticClass:"line-number"},[n._v("65")]),t("br"),t("span",{staticClass:"line-number"},[n._v("66")]),t("br"),t("span",{staticClass:"line-number"},[n._v("67")]),t("br"),t("span",{staticClass:"line-number"},[n._v("68")]),t("br"),t("span",{staticClass:"line-number"},[n._v("69")]),t("br"),t("span",{staticClass:"line-number"},[n._v("70")]),t("br"),t("span",{staticClass:"line-number"},[n._v("71")]),t("br"),t("span",{staticClass:"line-number"},[n._v("72")]),t("br"),t("span",{staticClass:"line-number"},[n._v("73")]),t("br"),t("span",{staticClass:"line-number"},[n._v("74")]),t("br"),t("span",{staticClass:"line-number"},[n._v("75")]),t("br"),t("span",{staticClass:"line-number"},[n._v("76")]),t("br"),t("span",{staticClass:"line-number"},[n._v("77")]),t("br"),t("span",{staticClass:"line-number"},[n._v("78")]),t("br"),t("span",{staticClass:"line-number"},[n._v("79")]),t("br"),t("span",{staticClass:"line-number"},[n._v("80")]),t("br"),t("span",{staticClass:"line-number"},[n._v("81")]),t("br"),t("span",{staticClass:"line-number"},[n._v("82")]),t("br"),t("span",{staticClass:"line-number"},[n._v("83")]),t("br"),t("span",{staticClass:"line-number"},[n._v("84")]),t("br"),t("span",{staticClass:"line-number"},[n._v("85")]),t("br"),t("span",{staticClass:"line-number"},[n._v("86")]),t("br"),t("span",{staticClass:"line-number"},[n._v("87")]),t("br"),t("span",{staticClass:"line-number"},[n._v("88")]),t("br"),t("span",{staticClass:"line-number"},[n._v("89")]),t("br"),t("span",{staticClass:"line-number"},[n._v("90")]),t("br"),t("span",{staticClass:"line-number"},[n._v("91")]),t("br"),t("span",{staticClass:"line-number"},[n._v("92")]),t("br"),t("span",{staticClass:"line-number"},[n._v("93")]),t("br"),t("span",{staticClass:"line-number"},[n._v("94")]),t("br"),t("span",{staticClass:"line-number"},[n._v("95")]),t("br"),t("span",{staticClass:"line-number"},[n._v("96")]),t("br"),t("span",{staticClass:"line-number"},[n._v("97")]),t("br"),t("span",{staticClass:"line-number"},[n._v("98")]),t("br"),t("span",{staticClass:"line-number"},[n._v("99")]),t("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);